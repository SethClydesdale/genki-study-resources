!function(e,a){"use strict";var s={stats:{problems:0,solved:0,mistakes:0,score:0,exclude:0},canNotify:"Notification"in e,isTouch:"ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,isTouching:!1,isTimerPausedByPopup:!1,feedbackMode:storageOK&&localStorage.feedbackMode?localStorage.feedbackMode:"classic",dataBackupReminderCount:storageOK&&localStorage.dataBackupReminderCount?+localStorage.dataBackupReminderCount:0,textSelectMode:!1,strokeNumberDisplay:!1,markedItem:null,ed:"lessons"+(/lessons-3rd/.test(e.location.pathname)?"-3rd":""),local:"file:"==e.location.protocol?"index.html":"",debug:/debug/.test(e.location.search)?"?debug":"",lang:{std_drag:'<span class="en">Drag the English expression to the Japanese expression that has the same meaning.<br>TIP: Click an expression to mark it, then click an empty field to drop the answer there.</span><span class="ja">英語の言葉を同じ意味を持つ日本語の言葉にドラッグしなさい。<br>ヒント：言葉をクリックすると選択になります。空のフィールドをクリックすると選択した言葉をドロップします。</span>',std_kana:'<span class="en">Drag the Kana to the matching Romaji.<br>TIP: Click the kana to mark it, then click an empty field to drop the answer there.</span><span class="ja">仮名をローマ字にドラッグしなさい。<br>ヒント：言葉をクリックすると選択になります。空のフィールドをクリックすると選択した言葉をドロップします。</span>',std_num:'<span class="en">Drag the Numbers to the matching Kana.<br>TIP: Click a number to mark it, then click an empty field to drop the answer there.</span><span class="ja">数を仮名にドラッグしなさい。<br>ヒント：言葉をクリックすると選択になります。空のフィールドをクリックすると選択した言葉をドロップします。</span>',std_multi:'<span class="en">Solve the problems by choosing the correct answers.</span><span class="ja">正解の答えを選択しなさい。</span>',std_questions:'<span class="en">Answer the questions as best as you can.</span><span class="ja">質問に答えなさい。</span>',std_written:'<span class="en">Complete the following problems.</span><span class="ja">次の質問に答えなさい。</span>',std_culture:'<span class="en">Answer the questions about Japanese culture as best as you can.</span><span class="ja">日本の文化について質問に答えなさい。</span>',std_stroke_order:'<span class="en">Practice drawing each kanji by following the stroke order.</span><span class="ja">それぞれの漢字の書き順を練習しなさい。</span>',std_drawing:'<span class="en">Practice drawing the following kanji multiple times.</span><span class="ja">それぞれの漢字を何度も書きなさい。</span>',vocab_multi:'<span class="en">Choose the correct definition for each Japanese expression.</span><span class="ja">それぞれの言葉の正解の定義を選択しなさい。</span>',vocab_writing:'<span class="en">Practice spelling the following words/expressions.</span><span class="ja">それぞれの言葉を何度も書きなさい。</span>',vocab_fill:'<span class="en">Write the Japanese definition for the following words/expressions.</span><span class="ja">日本語でそれぞれの言葉の定義を書きなさい。</span>',kana_multi:'<span class="en">Choose the correct Romaji for the %{KANA}.</span><span class="ja">%{KANA}のローマ字を選択しなさい。</span>',kana_writing:'<span class="en">Practice writing the following %{KANA}.</span><span class="ja">%{KANA}を書きなさい。</span>',kana_fill:'<span class="en">Complete the chart by filling in the Romaji.</span><span class="ja">チャートでローマ字を書き込みなさい。</span>',num_multi:'<span class="en">Read the Japanese and choose the correct numbers.</span><span class="ja">日本語を読んで正解の数を選択しなさい。</span>',num_writing:'<span class="en">Practice spelling the following numbers.</span><span class="ja">それぞれの数を書きなさい。</span>',num_fill:'<span class="en">Write the following numbers in Japanese (hiragana).</span><span class="ja">平仮名でそれぞれの数を書きなさい。</span>',kanji_readings_multi:'<span class="en">Choose the correct readings for each kanji.</span><span class="ja">それぞれの漢字の正解の読み方を選択しなさい。</span>',kanji_readings_drag:'<span class="en">Match each kanji with their readings.</span><span class="ja">それぞれの漢字を正解の読み方に合わせなさい。</span>',kanji_yomikata:'</div><p class="text-block en" style="margin:10px 0;">▶ indicates the <em>on-yomi</em> (pronunciation originally borrowed from Chinese).<br>▷ indicates the <em>kun-yomi</em> (native Japanese reading).</p><p class="text-block ja" style="margin:10px 0;">「▶」は音読み（中国の読み方）<br>「▷」は訓読み（日本の読み方）</p>',kanji_meanings_multi:'<span class="en">Choose the correct meanings for each kanji.</span><span class="ja">それぞれの漢字の正解の意味を選択しなさい。</span>',kanji_meanings_drag:'<span class="en">Match each kanji with their meanings.</span><span class="ja">それぞれの漢字を正解の意味に合わせなさい。</span>',opts:{kana:{kana:"Drag and Drop",multi:"Multiple Choice",writing:"Writing Practice",fill:"Fill in the Chart"},numbers:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Numbers"},kanji:{multi:"Multiple Choice",drag:"Drag and Drop"},vocab:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Definition"},practice:{multi:"Multiple Choice",fill:"Written",drag:"Drag and Drop"},hirakata:{fill:"Written",stroke:"Stroke Order Practice",drawing:"Drawing Practice"}},mistakes:'<span class="en">The items outlined in <span class="t-red t-bold">red</span> were answered wrong before finding the correct answer. Review these problems before trying again.</span><span class="ja"><span class="t-red t-bold">赤い</span>問題は不正確です。この問題を復習してやり直してください。</span>',writing_mistakes:'<span class="en">The items outlined in <span class="t-red t-bold">red</span> were answered wrong. Review these problems before trying again.</span><span class="ja"><span class="t-red t-bold">赤い</span>問題は不正確です。この問題を復習してやり直してください。</span>',multi_mistakes:'<span class="en">The answers you selected that were wrong are outlined in <span class="t-red t-bold">red</span>. The correct answers are outlined in <span class="t-blue t-bold">blue</span>. Review these problems before trying again.</span><span class="ja"><span class="t-red t-bold">赤い</span>問題は不正確で、正解の答えは<span class="t-blue t-bold">青い</span>です。この問題を復習してやり直してください。</span>',stroke_mistakes:'<span class="en">The characters you drew that were wrong are outlined in <span class="t-red t-bold">red</span>. Please review the stroke order and number of strokes for these characters before trying again.</span><span class="ja"><span class="t-red t-bold">赤い</span>漢字は不正解です。書き順を復習してやり直してください。</span><br><br><b>Note:</b> Sometimes answers may be marked wrong by mistake, due to a mismatch in the recognition algorithm.<br>Please use your own discretion if this occurs.',fill_mistakes:'<span class="en">The items underlined in <span class="t-red t-bold">red</span> were answered wrong, the correct answers are listed underneath in <span class="t-green t-bold">green</span>. Review these problems before trying again.</span><span class="ja"><span class="t-red t-bold">赤い</span>下線の問題は不正解で、正解の答えは<span class="t-green t-bold">緑色</span>で赤い下線の問題の下です。この問題を復習してやり直してください。</span>',sub_answers:'<b>Note:</b> Answers inside <span class="t-blue t-bold">blue</span> parentheses separated by "<span class="alt-phrase-sep">/</span>" are a list of possible sub-answers; only one can be used.<br>For example.. <span class="t-green"><span class="alt-phrase">(</span>あの<span class="alt-phrase-sep">/</span>その<span class="alt-phrase">)</span>ねこ</span>: そのねこ or あのねこ <span class="t-green">(good)</span> vs あの/そのねこ <span class="t-red">(bad)</span><br><span class="t-green"><span class="alt-phrase">(</span>この<span class="alt-phrase-sep">/</span><span class="alt-phrase">)</span>ねこ</span> means the sub-answer is optional; it can be left out.',review:'<div id="review-exercise" class="center clearfix"><button id="review-button" class="button" onclick="Genki.review();"><i class="fa">&#xf02d;</i><span class="en">Review</span><span class="ja">復習する</span></button></div>',toggle_furigana:'<button id="toggle-furigana" class="button" onclick="Genki.toggle.furigana(this);"><i class="fa">&#xf2a8;</i><span class="en">'+(storageOK&&"false"==localStorage.furiganaVisible?"Show":"Hide")+' Furigana</span><span class="ja">振り仮名を'+(storageOK&&"false"==localStorage.furiganaVisible?"":"非")+"表示する</span></button>",check_answers:'<div id="check-answers" class="center"><button id="check-answers-button" class="button" onclick="Genki.check.answers();"><i class="fa">&#xf00c;</i><span class="en">Check Answers</span><span class="ja">答え合わせをする</span></button></div>',back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i><span class="en">Back to Dictionary</span><span class="ja">辞書に戻る</span></button>'},active:{type:null,exercise:null,index:0,path:e.location.pathname.replace(/.*?\/lessons.*?\/(.*?\/.*?)\/.*/g,"$1")},exercises:e.GenkiExercises||null,scrollTo:function(e,s){"string"==typeof e&&(e=a.querySelector(e));var t=function(){a.body.scrollTop=e.offsetTop,a.documentElement.scrollTop=e.offsetTop};s?setTimeout(t,100):t()},QuizType:{DRAG:"drag",KANA:"kana",WRITING:"writing",MULTI:"multi",FILL:"fill",STROKE:"stroke",DRAWING:"drawing"},generateQuiz:function(t){!s.exerciseData&&e.JSON&&(s.exerciseData=JSON.stringify(t));var i=a.getElementById("quiz-zone");if("object"==typeof t.type){for(var n,l=!!/(?:begin|start)=\d/.test(e.location.search)&&e.location.search.replace(/.*?(?:begin|start)=(\d).*/,"$1"),r=0,o=t.type.length,c="";r<o;r++)c+='<option value="'+r+'"'+(!1!==l?r==l?" selected":"":storageOK&&localStorage["genki_pref_"+t.format]==t.type[r]?" selected":"")+">"+s.lang.opts[t.format][t.type[r]]+"</option>";return"ja"==GenkiLang&&(c=c.replace("Drag and Drop","ドラッグ＆ドロップ").replace("Multiple Choice","選択式").replace("Writing Practice","書き練習").replace("Spelling Practice","スペルの練習").replace("Write the Definition","言葉を書く").replace("Written","筆記テスト").replace("Stroke Order Practice","書き順の練習").replace("Extended Drawing Practice","連続の書き順の練習").replace("Drawing Practice","連続の書き順の練習").replace("Fill in the Chart","チャートを書き込む").replace("Write the Numbers","数を書く")),n=GenkiModal.open({title:'<span class="en">Please Select an Exercise Type</span><span class="ja">練習型を選択してください</span>',content:'<span class="en">Please select the type of exercise you would like to do, then click "Begin" to start studying.</span><span class="ja">練習型を選択してから練習を始めるために「始める」をクリックしてください。</span><br><br><div class="center">'+(/\/vocabulary-index\/|\/custom-vocab\//.test(e.location)?"":'<div><b><span class="en">Current Exercise</span><span class="ja">今の練習</span></b><br>'+a.title.replace(/ \| Genki Study Resources.*$/,"")+"</div><br>")+'<div><b><span class="en">Exercise Type</span><span class="ja">練習型</span></b><br><select id="exercise-type">'+c+'</select></div><br><div title="'+("ja"==GenkiLang?"練習型を変更したいなら練習ページの下の「練習型を変更する」をクリックしてください。":"The exercise type can still be changed via the Change Exercise Type button at the bottom of an exercise.")+'"><input id="modal-skip-ex-type" class="genki_input_hidden" type="checkbox"'+(storageOK&&"true"==localStorage.genkiSkipExType?" checked":"")+' onchange="localStorage.genkiSkipExType = this.checked"><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><label class="checkbox-label" for="modal-skip-ex-type"><span class="en">Skip Exercise Type Selection</span><span class="ja">練習型の選択をスキップする</span></label></div></div>',buttonHTML:'<span class="en">Begin</span><span class="ja">始める</span>',noClose:1,zIndex:"low",callback:function(){var e=a.getElementById("exercise-type").value;if(t.type=t.type[e],t.info="object"==typeof t.info&&t.info[e]?t.info[e]:t.info,storageOK&&(localStorage["genki_pref_"+t.format]=t.type),/vocab|kana|numbers|kanji/.test(t.format)){if("kana"==t.format&&"kana"!=t.type){var i={};for(x in t.quizlet)for(d in t.quizlet[x])i[d]=t.quizlet[x][d];t.quizlet=i,t.info=t.info.replace(/%\{KANA\}/g,s.active.exercise[1].replace(/.*?(Hiragana|Katakana).*/,function(e){return"ja"==GenkiLang?/Hiragana/i.test(e)?"ひらがな":"カタカナ":e}))}if("kanji"==t.format){if(t.readings){for(x in t.quizlet){var n=t.quizlet[x].split("|");t.quizlet[x]=(n[0]?'<span class="yomikata" title="'+("ja"==GenkiLang?"音読み":"on-yomi")+'">▶</span>'+n[0]+"<br>":"")+(n[1]?'<span class="yomikata" title="'+("ja"==GenkiLang?"訓読み":"kun-yomi")+'">▷</span>'+n[1]:"")}t.info+=s.lang.kanji_yomikata}"drag"==t.type&&(a.getElementById("exercise").className+=t.readings?" kanji-readings":t.meanings?" kanji-meanings":"")}if("multi"==t.type){var l,r,o,c,d,p,u=[],g=[],h=[];for(x in t.quizlet)g.push(x),h.push(x);for(x=0,q=g.length;x<q;x++){for(y=g[j=Math.floor(Math.random()*g.length)].split("|"),l=t.quizlet[g[j]].replace(/\|.*?$/,""),r=/\|/.test(t.quizlet[g[j]])?t.quizlet[g[j]].replace(/.*?\|(.*?$)/,"$1"):"",u.push({question:'<div class="multi-vocab">'+(y[1]?"<ruby>":"kanji"==t.format?'<div class="big-kanji">':"")+y[0]+(y[1]?"<rt>"+y[1]+"</rt></ruby>":"kanji"==t.format?"</div>":"")+(r?'<hr><div class="multi-vocab-sentence">'+r+"</div>":"")+"</div>",answers:["A"+l]}),(c=h.slice()).splice(j,1),d=3;d-- >0&&c.length;)p=Math.floor(Math.random()*c.length),(o=t.quizlet[c[p]].replace(/\|.*?$/,""))==l?d++:u[x].answers.push("A"==o.charAt(0)?"!"+o:o),c.splice(p,1);g.splice(j,1)}t.quizlet=u}else if("writing"==t.type){var m;u={};for(x in t.quizlet)for(var k,f=(m=x.split("|"))[0].split("／"),v=0,b=f.length;v<b;v++)k=m[1]?m[1]:"kana"==t.format?t.quizlet[x]:"",u[f[v].replace(/\(.*?\)|（.*?）|～/g,"")]=k,/\(.*?\)|（.*?）/.test(f[v])&&(u[f[v].replace(/～|\(|\)|（|）/g,"")]=k);t.quizlet=u,t.columns=6}else if("fill"==t.type)if(/vocab|numbers/.test(t.format)){var y,w,x,q,j;u='<div class="count-problems columns-2 clear"><div>',g=[];for(x in t.quizlet)g.push(x);for(x=0,q=g.length,j=Math.ceil(q/2);x<q;x++)w=("{"+(y=g[x].split("|"))[0].replace(/。|～/g,"")+(y[1]?"|"+y[1].replace(/。|～/g,""):"")+(/。|～/g.test(y[0])?"|"+y[0]:"")+(y[1]&&/。|～/g.test(y[1])?"|"+y[1]:"")+"}").replace(/\((.*?)\)/g,"%($1/)").replace(/（(.*?)）/g,"%($1/)").replace(/／/g,"|"),u+=(x==j?"</div><div>":"")+'<div class="problem">'+t.quizlet[g[x]].replace(/\|.*?$/,"")+"<br>"+(/\|/.test(w)?w.replace("}","|answer}"):w)+"</div>";t.quizlet=u+"</div></div>"}else"kana"==t.format&&(t.quizlet=t.chart)}else if("practice"==t.format){t.quizlet=t.quizlet[e];var z=a.querySelector(".multi-quiz-image");"fill"==t.type&&z?z.style.display="none":"multi"==t.type&&z&&(z.style.display="")}else"hirakata"==t.format&&(t.quizlet=t.quizlet[e]?t.quizlet[e]:t.quizlet[t.quizlet.length-1]);s.generateQuiz(t),s.changingExType=!1}}),!s.changingExType&&(!1!==l||storageOK&&"true"==localStorage.genkiSkipExType)&&(n.callback(),GenkiModal.close()),s.create.exerciseTypeButton(),!1}if(s.active.type=t.type,/\!GRI/.test(t.info)&&(t.info=t.info.replace(/\{.*?\}/g,function(e){var a=e.slice(1,e.length-1).split("|");return'<a href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+s.local+"#"+a[2]+'" target="_blank"'+(s.local&&!s.debug?"":" onclick=\"Genki.getGrammarPoint(this, '"+a[2]+"'); return false;\"")+">"+a[1]+"</a>"})),"drag"==t.type){var d,p,u='<div id="quiz-info">'+t.info+'</div><div id="question-list">',g='<div id="drop-list">',h=[];for(r in t.quizlet)h.push(r);for(d=h.slice(0);h.length;)r=Math.floor(Math.random()*h.length),u+='<div class="quiz-item-group"><div class="quiz-item" '+((w=/\|/.test(h[r])?'data-helper="'+h[r].split("|").pop()+'"':null)||"")+">"+(w?h[r].replace(/(.*?)\|(.*)/,'$1<span class="hidden-text">$2</span>'):h[r])+"</div></div>",g+='<div tabindex="0" class="quiz-answer-zone'+(/\|/.test(h[r])?" helper-answer":"")+'" data-text="'+h[r].replace(/\|.*?$/,"")+'" data-mistakes="0"></div>',h.splice(r,1),++s.stats.problems,!p&&w&&(p=!0);for(u+="</div>"+g+"</div>",p&&(i.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),u+='<div id="answer-list">';d.length;)u+='<div tabindex="0" class="quiz-item" data-answer="'+d[r=Math.floor(Math.random()*d.length)].replace(/\|.*?$/,"")+'"><div class="quiz-item-text">'+t.quizlet[d[r]].replace(/\|.*?$/,"")+"</div></div>",d.splice(r,1);u+="</div>",i.innerHTML=u+s.lang.review.replace("</div>",s.lang.toggle_furigana+'<button id="toggle-orientation" class="button" onclick="Genki.toggle.vocabOrientation(this);"><i class="fa" style="position:relative;transform:rotate(90deg);">&#xf0db;</i><span class="en">Horizontal Mode</span><span class="ja">水平モード</span></button></div>'),storageOK&&"true"==localStorage.vocabHorizontal&&s.toggle.vocabOrientation(a.getElementById("toggle-orientation"),"false")}else if("kana"==t.type){u='<div id="quiz-info">'+t.info+'</div><div id="question-list" class="clear">';var m,k='<div id="answer-list">',f=[],v=t.quizlet;for(r=v.length-1;r>-1;r--){u+='<div class="quiz-column">';for(m in v[r])u+='<div class="quiz-item-row"><div tabindex="0" class="quiz-answer-zone" data-text="'+v[r][m]+'" data-mistakes="0"></div><div class="quiz-item">'+v[r][m]+"</div></div>",f.push('<div tabindex="0" class="quiz-item" data-answer="'+v[r][m]+'">'+m+"</div>"),++s.stats.problems;u+="</div>"}for(;f.length;)k+=f[r=Math.floor(Math.random()*f.length)],f.splice(r,1);i.innerHTML=u+"</div>"+k+"</div>"+s.lang.review}else if("writing"==t.type){u='<div id="quiz-info">'+t.info+'<br><span class="en">If you don\'t know how to type in Japanese on your computer, please visit our help page by <a href="../../../help/writing/'+s.local+'" target="_blank">clicking here</a>.</span><span class="ja">パソコンで日本語を入力する方法がわからない場合は、<a href="../../../help/writing/'+s.local+'" target="_blank">ヘルプページ</a>をご覧ください。</span></div><div id="question-list">';var b='style="width:'+100/((N=t.columns)+1)+'%;"',y=0,w=!1;for(r in t.quizlet){for(u+='<div class="quiz-answer-row'+(t.quizlet[r]?" furi-row":"")+'"><div class="quiz-item" data-helper="'+t.quizlet[r]+'" '+b+'><div class="quiz-item-text">'+r+"</div></div>",o=0;N-- >0;)u+='<div class="writing-zone" '+b+'><input class="writing-zone-input" type="text" '+(!t.quiz&&o++<3?'placeholder="'+r+'"':"")+' data-answer="'+(t.quiz?t.quizlet[r]:r)+'" data-mistakes="0" tabindex="0" '+(t.quiz?"":'oninput="Genki.check.value(this);"')+' onfocus="Genki.input.index = '+y+++'"></div>',++s.stats.problems;u+="</div>",N=t.columns}/data-helper/.test(u)&&(w=!0,i.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),i.innerHTML=u+"</div>"+s.lang.check_answers.replace("</div>",w?s.lang.toggle_furigana+"</div>":"</div>"),t.quiz&&(i.className+=" no-helper"),s.input={map:a.querySelectorAll(".writing-zone-input"),index:0},s.input.map[0].autofocus=!0}else if("multi"==t.type){u='<div id="quiz-info">'+t.info+'</div><div id="question-list">',k='<div id="answer-list">';var x=65,q=!1,j=(w=!1,/"format":"vocab"/.test(s.exerciseData));for(r=0,o=(M=t.quizlet).length;r<o;r++){if(u+='<div id="quiz-q'+r+'" class="question-block" data-qid="'+(r+1)+'" style="display:none;"><div class="quiz-multi-question">'+(t.questionsAlignLeft?'<div class="quiz-question-inner-text">':"")+(void 0!==M[r].question?M[r].question.replace(/\{.*?\}/g,function(e){var a=e.slice(1,e.length-1).split("|");if("!IMG"==a[0])return s.parse.image(a)}):'<div class="text-passage'+(M[r].vertical?" vertical-text":"")+'" '+(M[r].text.replace(/<br>/g,"").length<50?'style="text-align:center;"':"")+">"+M[r].text+"</div>"+(M[r].helper||""))+(t.questionsAlignLeft?"</div>":"")+"</div>"+(j?'<button class="button vocab-spoiler-toggle" onclick="Genki.toggle.vocabSpoiler(this);"><i class="fa"></i><span class="en">Show Choices</span><span class="ja">選択肢を表示する</span></button><div class="vocab-spoiler">':""),M[r].text)u+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, true);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, true);">NEXT</div></div>',++s.stats.exclude;else for(;M[r].answers.length;)E=Math.floor(Math.random()*M[r].answers.length),/^A|^\!/.test(M[r].answers[E])&&("A"==M[r].answers[E].charAt(0)&&(q=!0),M[r].answers[E]=M[r].answers[E].slice(1)),u+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer" data-answer="'+q+'" data-option="'+String.fromCharCode(x++)+'" onclick="Genki.progressQuiz(this);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this);"><div class="quiz-answer-inner-text">'+M[r].answers[E]+"</div></div></div>",q=!1,M[r].answers.splice(E,1);u+=(j?"</div>":"")+"</div>",x=65,++s.stats.problems}/class="furigana"|class="inline-furi"|<ruby>/.test(u)&&(w=!0,i.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),j&&storageOK&&"true"==localStorage.spoilerMode&&(i.className+=" spoiler-mode"),i.innerHTML=u+'</div><div id="next-button" class="quiz-multi-row" style="margin-top:-20px; visibility:hidden;'+("classic"==s.feedbackMode?"display:none;":"")+'"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.showNextQuestion(this);" onkeypress="event.key == \'Enter\' && Genki.showNextQuestion(this);">NEXT</div></div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix">'+(s.appendix?"":'<button class="button text-selection-mode-button" onclick="Genki.toggle.textSelection(this);"><i class="fa">&#xf246;</i> <span class="en">Enable Text Selection</span><span class="ja">テキスト選択モードを有効にする</span></button>')+(w?s.lang.toggle_furigana:"")+"</div>",s.progressQuiz("init")}else if("fill"==t.type){w=!1;/class="furigana"|class="inline-furi"|<ruby>/.test(t.quizlet)&&(w=!0,i.className+=" helper-"+(storageOK&&"false"==localStorage.furiganaVisible?"hidden":"present")),i.innerHTML='<div id="quiz-info">'+t.info+'<br><span class="en">If you don\'t know how to type in Japanese on your computer, please visit our help page by <a href="../../../help/writing/'+s.local+'" target="_blank">clicking here</a>.</span><span class="ja">パソコンで日本語を入力する方法がわからない場合は、<a href="../../../help/writing/'+s.local+'" target="_blank">ヘルプページ</a>をご覧ください。</span></div><div class="text-block">'+t.quizlet.replace(/\{.*?\}/g,function(e){var a,t,i,n,l,r=e.slice(1,e.length-1).split("|");return"!IMG"==r[0]?s.parse.image(r):"!GRI"==r[0]?'<a href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+s.local+"#"+r[2]+'" target="_blank"'+(s.local&&!s.debug?"":" onclick=\"Genki.getGrammarPoint(this, '"+r[2]+"'); return false;\"")+">"+r[1]+"</a>":"!AUDIO"==r[0]?'<div class="audio-block center"><audio id="'+r[1]+'" controls><source src="'+getPaths()+"resources/audio/"+("lessons-3rd"==s.ed?"3rd-edition/":"2nd-edition/")+r[1]+'.mp3" type="audio/mpeg"></audio></div>':"!PLAY"==r[0]?'<button class="button play-button" onclick="Genki.playAudio(\''+r[1]+"', "+r[2]+');"><i class="fa">&#xf04b;</i></button>':(a=r[1]?r[1]:"",t=(r[10]||r[9]||r[8]||r[7]||r[6]||r[5]||r[4]||r[3]||r[2]?r[10]||r[9]||r[8]||r[7]||r[6]||r[5]||r[4]||r[3]||r[2]:"").split(";"),(/\%\((.*?)\)/.test(a)||/\%\((.*?)\)/.test(r[0]))&&(i=[r[0].match(/%\((.*?)\)/),a.match(/%\((.*?)\)/)]),++s.stats.problems,n=/width:/.test(t[0])?t[0].split(":")[1]:t[1]&&/width:/.test(t[1])?t[1].split(":")[1]:t[2]&&/width:/.test(t[2])?t[2].split(":")[1]:i?(a?(i[0]&&i[0][1]||"/").split("/").concat((i[1]&&i[1][1]||"/").split("/")):(i[0]&&i[0][1]||"/").split("/")).sort(function(e,a){return a.length-e.length})[0].length*(14/(/[a-z]/i.test(a||r[0])&&!/[\u3000-\u30FF]/.test(a||r[0])?2:1))+14+[a.replace(/\%\((.*?)\)/g,""),r[0].replace(/\%\((.*?)\)/g,"")].sort(function(e,a){return a.length-e.length})[0].length*(14/(/[a-z]/i.test(a||r[0])&&!/[\u3000-\u30FF]/.test(a||r[0])?2:1)):[a,r[0]].sort(function(e,a){return a.length-e.length})[0].length*(14/(/[a-z]/i.test(a||r[0])&&!/[\u3000-\u30FF]/.test(a||r[0])?2:1))+14,l=/placeholder:/.test(t[0])?t[0].split(":")[1]:t[1]&&/placeholder:/.test(t[1])?t[1].split(":")[1]:t[2]&&/placeholder:/.test(t[2])?t[2].split(":")[1]:null,'<span class="writing-zone"><input class="writing-zone-input" type="text" data-answer="'+r[0]+'" '+("answer"==t[0]?'data-answer2="'+a+'" ':"")+("answer"==t[0]&&r[3]?'data-answer3="'+r[2]+'" ':"")+("answer"==t[0]&&r[4]?'data-answer4="'+r[3]+'" ':"")+("answer"==t[0]&&r[5]?'data-answer5="'+r[4]+'" ':"")+("answer"==t[0]&&r[6]?'data-answer6="'+r[5]+'" ':"")+("answer"==t[0]&&r[7]?'data-answer7="'+r[6]+'" ':"")+("answer"==t[0]&&r[8]?'data-answer8="'+r[7]+'" ':"")+("answer"==t[0]&&r[9]?'data-answer9="'+r[8]+'" ':"")+("answer"==t[0]&&r[10]?'data-answer10="'+r[9]+'" ':"")+("furigana"==t[0]?'data-furigana="'+a+'" ':"")+("placeholder"==t[0]||l?'placeholder="'+(l||a)+'" ':"")+'data-mistakes="0" tabindex="0" data-default-width="'+n+'" style="width:'+n*(storageOK&&localStorage.genkiFontSize?+localStorage.genkiFontSize/100:1)+'px;">'+(a&&!/answer|furigana|placeholder/.test(t[0])||t[1]&&/hint:/.test(t[1])||t[2]&&/hint:/.test(t[2])?'<span class="problem-hint">'+(t[1]&&/hint:/.test(t[1])?t[1].split(":")[1]:t[2]&&/hint:/.test(t[2])?t[2].split(":")[1]:a)+"</span>":"")+"</span>")})+"</div>"+s.lang.check_answers.replace("()","(false, 'fill')").replace("</div>",w?s.lang.toggle_furigana+"</div>":"</div>"),a.querySelector(".writing-zone-input").autofocus=!0}else if("stroke"==t.type){u='<div id="quiz-info">'+t.info+'</div><div id="question-list">',k='<div id="answer-list">';var z,T=storageOK&&"false"==localStorage.strokeOrderVisible,S=storageOK&&"false"==localStorage.tracingGuideVisible;for(r=0,o=(M=t.quizlet).length;r<o;r++)M[r].kana&&(M[r].kanji=M[r].kana),t.kanaType&&(t.kanaType=t.kanaType.charAt(0).toUpperCase()+t.kanaType.slice(1).toLowerCase()),z=getPaths()+"resources/images/stroke-order/"+M[r].order+".png",u+='<div id="quiz-q'+r+'" class="question-block" data-qid="'+(r+1)+'" style="display:none;"><div class="quiz-multi-question"><div class="kanji-container big-kanji'+(M[r].kana?" kana-font":"")+'"'+(M[r].font?' style="font-family:'+M[r].font+'"':"")+">"+M[r].kanji+'</div><div class="kanji-stroke-order"><a class="button-link" href="'+(M[r].kana?getPaths()+"resources/images/stroke-order/sasagami-"+t.kanaType.toLowerCase()+".jpg":"https://jisho.org/search/"+M[r].kanji+"%20%23kanji")+'" target="_blank" title="'+("ja"==GenkiLang?"jisho.orgで書き順を見る":"View stroke order on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+z+'" target="_blank" title="'+("ja"==GenkiLang?"クリックして画像を見る":"Click to view image")+'"><img src="'+z+'" alt="'+("ja"==GenkiLang?"書き順":"stroke order")+'"/></a></div></div><div class="quiz-multi-row"><canvas class="kanji-canvas" data-kanji="'+M[r].kanji+'" data-strokes="'+M[r].strokes+'" data-guide="'+!S+'"'+(M[r].kana&&!M[r].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':M[r].font?' data-font="'+M[r].font+'"':"")+' id="canvas-'+r+'" width="200" height="200"'+(M[r].kana?'data-kana="true"':"")+'></canvas></div><div class="kanji-canvas-actions quiz-multi-row center"><button class="button" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+r+'" title="(CTRL+X)"><i class="fa">&#xf12d;</i><span class="en">Erase</span><span class="ja">消す</span></button><button class="button" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+r+'" title="(CTRL+Z)"><i class="fa">&#xf0e2;</i><span class="en">Undo</span><span class="ja">取り消す</span></button>'+(s.debug?'<button class="button" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+r+'" title="Open console (F12) to see recognition candidates (CTRL+F)"><i class="fa">&#xf188;</i><span class="en">Test Recognition</span><span class="ja">テストする</span></button>':"")+'</div><div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, false, \'stroke\');" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, false, \'stroke\');" data-canvas="canvas-'+r+'"><span class="en">Next '+(M[r].kana?t.kanaType:"Kanji")+'</span><span class="ja">次の'+(M[r].kana?"ja"==GenkiLang?/hiragana/i.test(t.kanaType)?"ひらがな":"カタカナ":t.kanaType:"漢字")+"</span></div></div></div>",++s.stats.problems;i.innerHTML=u+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div><div id="review-exercise" class="center clearfix"><button id="toggle-stroke-order" class="button" onclick="Genki.toggle.strokeOrder(this);"><i class="fa">&#xf1fc;</i><span class="en">'+(T?"Show":"Hide")+' Stroke Order</span><span class="ja">書き順を'+(T?"表示":"非表示")+'する</span></button><button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i><span class="en">'+(S?"Show":"Hide")+' Tracing Guide</span><span class="ja">トレースのガイドを'+(S?"表示":"非表示")+'する</span></button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i><span class="en">Show Stroke Numbers</span><span class="ja">画数を表示する</span></button></div>',T&&(i.className+=" stroke-order-hidden"),s.progressQuiz("init",!1,"stroke")}else if("drawing"==t.type){u='<div id="quiz-info">'+t.info+'</div><div id="question-list">',S=storageOK&&"false"==localStorage.tracingGuideVisible,b='style="width:'+100/((N=t.columns)+1)+'%;"';var N,M=t.quizlet,E=0;for(r=0,o=t.quizlet.length;r<o;r++){for(M[r].kana&&(M[r].kanji=M[r].kana),u+='<div class="quiz-answer-row"><div class="drawing-zone" '+b+'><div class="quiz-item"><div class="quiz-item-text'+(M[r].kana?" kana-font":"")+'"'+(M[r].font?' style="font-family:'+M[r].font+'"':"")+">"+M[r].kanji+'</div></div><button class="button stroke-order-button" onclick="Genki.viewStrokeOrder(\''+M[r].kanji+"', '"+M[r].order+"'"+(M[r].kana?",'"+t.kanaType+"'":"")+');"><span class="en">Stroke Order</span><span class="ja">書き順を見る</span></button></div>';N-- >0;)u+='<div class="drawing-zone" '+b+'><canvas class="kanji-canvas" data-kanji="'+M[r].kanji+'" data-guide="'+(!(t.columns-N>3)&&!S)+'"'+(M[r].kana&&!M[r].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':M[r].font?' data-font="'+M[r].font+'"':"")+' data-strokes="'+M[r].strokes+'" data-size="100" id="canvas-'+E+'" width="110" height="110"'+(M[r].kana?'data-kana="true"':"")+'></canvas><div class="kanji-canvas-actions"><button class="button icon-only" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+E+'" title="'+("ja"==GenkiLang?"消す":"Erase")+' (CTRL+X)"><i class="fa">&#xf12d;</i></button><button class="button icon-only" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+E+'" title="'+("ja"==GenkiLang?"取り消す":"Undo")+' (CTRL+Z)"><i class="fa">&#xf0e2;</i></button>'+(s.debug?'<button class="button icon-only" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+E+'" title="'+("ja"==GenkiLang?"テストする":"Test Recognition")+' (CTRL+F)"><i class="fa">&#xf188;</i></button>':"")+"</div></div>",++s.stats.problems,++E;u+="</div>",N=t.columns}i.innerHTML=u+"</div>"+s.lang.check_answers.replace("()","(false, 'drawing')").replace("</div>",'<button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i><span class="en">'+(S?"Show":"Hide")+' Tracing Guide</span><span class="ja">トレースのガイドを'+(S?"表示":"非表示")+'する</span></button><button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i><span class="en">Show Stroke Numbers</span><span class="ja">画数を表示する</span></button></div>');var L=a.querySelectorAll(".kanji-canvas");for(r=0,o=L.length;r<o;r++)KanjiCanvas.init(L[r].id)}if(s.currentAnswers){if(t.type==s.currentAnswers.type)for(r=0,o=(B=a.querySelectorAll(".writing-zone-input")).length;r<o;r++)B[r].value=s.currentAnswers.list[r];delete s.currentAnswers}if("drag"==t.type||"kana"==t.type){var I=dragula([a.querySelector("#answer-list")],{isContainer:function(e){return e.classList.contains("quiz-answer-zone")}});I.on("drag",function(e){s.isTouch&&s.isTouching&&"hidden"!=a.body.style.overflow&&(a.body.style.overflow="hidden"),s.markedItem&&(s.markedItem.className=s.markedItem.className.replace(" markedItem",""),s.markedItem=null),s.markedItem=e,e.className+=" markedItem"}),s.isTouch&&I.on("cancel",function(){a.body.style.overflow=""}),I.on("drop",function(e,t,i){s.isTouch&&(a.body.style.overflow=""),t.dataset.text&&(e.dataset.answer!=t.dataset.text?(a.getElementById("answer-list").appendChild(e),t.dataset.mistakes=++t.dataset.mistakes,t.dataset.mistakes>1?s.stats.mistakes:++s.stats.mistakes):(t.className+=" answer-correct",s.markedItem&&(s.markedItem.className="quiz-item",s.markedItem=null),++s.stats.solved==s.stats.problems&&s.endQuiz()))}),s.drake=I,s.globalEventListenersSet||(s.globalEventListenersSet=!0,["click","keypress"].forEach(function(e){a.addEventListener(e,function(e){if(!("keypress"==e.type&&"Enter"!=e.key||s.quizOver)){for(var t=e.target,i=4,n=i-1;i-- >0&&(i<n&&(t=t.parentNode?t.parentNode:t),!/quiz-item$|quiz-answer-zone/.test(t.className)););/quiz-item/.test(t.className)&&"answer-list"==t.parentNode.id?(s.markedItem&&(s.markedItem.className=s.markedItem.className.replace(" markedItem","")),s.markedItem=t,s.markedItem.className+=" markedItem"):s.markedItem&&/quiz-answer-zone/.test(t.className)?s.markedItem.dataset.answer!=t.dataset.text?(s.wrongTimeout&&(a.getElementById("wrongAnswer").id="",clearTimeout(s.wrongTimeout),delete s.wrongTimeout),t.id="wrongAnswer",s.wrongTimeout=setTimeout(function(){a.getElementById("wrongAnswer").id="",delete s.wrongTimeout},1e3),t.dataset.mistakes=++t.dataset.mistakes,++s.stats.mistakes):(t.className+=" answer-correct",t.appendChild(s.markedItem),t.tabIndex=-1,t.firstChild.tabIndex=-1,s.markedItem.className=s.markedItem.className.replace(" markedItem",""),s.markedItem=null,++s.stats.solved==s.stats.problems&&s.endQuiz()):s.markedItem&&(s.markedItem.className=s.markedItem.className.replace(" markedItem",""),s.markedItem=null),"click"==e.type&&/quiz-answer-zone/.test(e.target.className)&&e.target.blur()}})}))}var G=new Timer,H=a.getElementById("quiz-timer");if(H.innerHTML="00:00:00",G.start(),G.addEventListener("secondsUpdated",function(e){H.innerHTML=G.getTimeValues().toString()}),s.timer=G,storageOK&&"false"!=localStorage.timerAutoPause&&a.addEventListener("visibilitychange",s.startOrPauseTimerByVisibility),a.getElementById("exercise").className+=" content-loaded "+("stroke"==t.type?"stroke-quiz multi":t.type)+"-quiz",s.scrollTo("#exercise-title",!0),(s.debug||!/drag|kana|drawing|stroke/.test(t.type)&&!s.appendix)&&(s.debug||t.format&&!/vocab|kana|numbers/.test(t.format)||!t.format)&&s.quickJisho.create(),"fill"==t.type||"writing"==t.type){var C=a.querySelector("[autofocus]");C&&C!=a.activeElement&&(C.focus(),s.debug&&console.warn("autofocus failed: HTMLElement.focus() will be used as a fallback."))}if("multi"==t.type){(M=a.querySelector(a.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&M.focus()}var B;for(r=0,o=(B=a.querySelectorAll("AUDIO")).length;r<o;r++)B[r].onplay=function(){for(var e=a.querySelectorAll("AUDIO"),s=0,t=e.length;s<t;s++)e[s]==this||e[s].paused||e[s].pause()},s.debug&&(B[r].ontimeupdate=function(){console.log(this.id,this.currentTime)})},incrementProgressBar:function(){var e=a.getElementById("quiz-progress-bar"),t=Math.floor((s.stats.solved+1)/s.stats.problems*100);e.style.width=t+"%",e.innerHTML='<span id="quiz-progress-text">'+(s.stats.solved+1)+"/"+s.stats.problems+"</span>"},progressQuiz:function(e,t,i){if(s.textSelectMode||s.quizOver)return!1;if("init"==e)a.getElementById("quiz-q"+s.stats.solved).style.display="",s.incrementProgressBar();else{if(e&&"stroke"==i){var n=KanjiCanvas.recognize(e.dataset.canvas);e=e.parentNode.parentNode.querySelector(".kanji-canvas"),s.debug&&console.log("toDraw: "+e.dataset.kanji),s.debug&&console.log("Results: "+n),s.debug&&console.log("Correct: "+(new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes).toString()),e.dataset.answer=new RegExp(e.dataset.kanji).test(n)&&e.dataset.strokesAnswer==e.dataset.strokes}e.className+=" selected-answer",t&&(e.parentNode.className+=" hidden-answer"),"false"==e.dataset.answer&&(e.parentNode.parentNode.className+=" wrong-answer",++s.stats.mistakes);var l=a.getElementById("quiz-q"+s.stats.solved++),r=a.getElementById("quiz-q"+s.stats.solved);if(r)if("instant"==s.feedbackMode&&"multi"==s.active.type)s.multiNodes||(s.multiNodes={list:a.getElementById("question-list"),button:a.getElementById("next-button"),next:null,last:null}),s.quizOver=!0,s.multiNodes.list.className+=" multi-quiz quiz-over",s.multiNodes.button.style.visibility="visible",s.multiNodes.button.firstChild.focus(),s.multiNodes.next=r,s.multiNodes.last=l;else{r.style.display="",l.style.display="none";(o=r.querySelector(a.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer"))&&o.focus(),s.incrementProgressBar()}else{s.endQuiz(i==s.QuizType.STROKE?i:s.QuizType.MULTI);for(var o,c=0,d=(o=a.querySelectorAll('[id^="quiz-q"]')).length;c<d;c++)o[c].style.display="";a.getElementById("quiz-progress").style.display="none"}}"stroke"==i&&a.getElementById("canvas-"+s.stats.solved)&&KanjiCanvas.init("canvas-"+s.stats.solved)},showNextQuestion:function(e){s.multiNodes.next.style.display="",s.multiNodes.last.style.display="none",s.quizOver=!1,s.multiNodes.list.className=s.multiNodes.list.className.replace(" multi-quiz quiz-over",""),s.multiNodes.button.style.visibility="hidden";var t=s.multiNodes.next.querySelector(a.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");t&&t.focus(),s.incrementProgressBar()},endQuiz:function(t){s.quizOver=!0,t="drawing"==t?"stroke":t;var i=s.stats.solved-s.stats.exclude,n=s.stats.problems-s.stats.exclude;s.stats.score=Math.floor(100*(i-s.stats.mistakes)/n),s.timer.stop();var l=a.getElementById("quiz-timer");if(l.style.display="none",a.getElementById("quiz-result").innerHTML='<div id="complete-banner" class="center"><span class="en">Quiz Complete!</span><span class="ja">テスト終了！</span></div><div id="result-list"><div class="result-row"><span class="result-label"><span class="en">Problems Solved:</span><span class="ja">問題を解いた：</span></span>'+n+'</div><div class="result-row"><span class="result-label"><span class="en">Answers Wrong:</span><span class="ja">不正解の問題：</span></span>'+s.stats.mistakes+'</div><div class="result-row"><span class="result-label"><span class="en">Score:</span><span class="ja">得点：</span></span>'+s.stats.score+'%</div><div class="result-row"><span class="result-label"><span class="en">Completion Time:</span><span class="ja">かかった時間：</span></span>'+l.innerHTML+'</div><div class="result-row center">'+(100==s.stats.score?'<span class="en">PERFECT! Great Job, you have mastered this quiz! Feel free to move on or challenge yourself by trying to beat your completion time.</span><span class="ja">満点！たいへんよくできました！</span>':s.stats.score>70?'<span class="en">Nice work!</span><span class="ja">よくできました！</span> '+s.lang[t?t+"_mistakes":"mistakes"]:'<span class="en">Keep studying!</span><span class="ja">頑張りましょう！</span> '+s.lang[t?t+"_mistakes":"mistakes"])+(a.querySelector(".alt-phrase")?"<br><br>"+s.lang.sub_answers:"")+'<div class="center">'+(/\/dictionary\//.test(e.location)?s.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i><span class="en">Try Again</span><span class="ja">やり直す</span></button>')+'<button class="button" onclick="Genki.breakTime();"><i class="fa">&#xf0f4;</i><span class="en">Take a Break</span><span class="ja">休憩する</span></button><a href="'+a.getElementById("home-link").href+'" class="button"><i class="fa">&#xf015;</i><span class="en">Back to Index</span><span class="ja">トップページに戻る</span></a></div></div></div>',storageOK&&s.active.exercise.length>0&&!/appendix|study-tools/.test(s.active.exercise[0])){var r=s.active.exercise[0],o=localStorage.GenkiEdition,c=JSON.parse(localStorage.Results);c[o]||(c[o]={});var d=c[o];d[r]=void 0===d[r]||s.stats.score>d[r]?s.stats.score:d[r],localStorage.Results=JSON.stringify(c),s.create.removeExerciseList(),s.create.exerciseList(),"true"!=localStorage.dataBackupReminder&&void 0!=localStorage.dataBackupReminder||(++s.dataBackupReminderCount>=10&&(s.dataBackupReminderCount=0,setTimeout(function(){GenkiModal.open({title:'<span class="en">Backup Exercise Score Data?</span><span class="ja">練習の得点データを保存しますか？</span>',content:'<span class="en">You\'ve recently completed 10 exercises. Would you like to backup your exercise score data?</span><span class="ja">練習が10回終わりました。練習の得点データを保存しますか？</span><br><br><div class="center"><a id="save-exercise-data" class="button" download="Genki Exercise Score Data.txt" href="data:text/plain;charset=utf-8,'+(storageOK&&localStorage.Results?encodeURIComponent(localStorage.Results.replace(/\n/g,"\r\n")):"")+'"><i class="fa">&#xf019;</i><span class="en">Save Data</span><span class="ja">セーブする</span></a><br><br><div title="'+("ja"==GenkiLang?"このポップアップを無効にします。\nデータを保存するリマインダーが再有効にしたいなら設定で有効にできます。":"Stops this popup from showing every 10 exercises.\nYou can re-enable the data backup reminder via the settings manager. ")+'"><input id="modal-data-backup-reminder" class="genki_input_hidden" type="checkbox" onchange="localStorage.dataBackupReminder = this.checked == true ? false : true;"><span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span><label class="checkbox-label" for="modal-data-backup-reminder"><span class="en">Disable Data Backup Reminders</span><span class="ja">データを保存するリマインダーを無効にする</span></label><br><br></div><div><div class="donate-box clear"><div class="donate-icon"><i class="fa">&#xf004;</i></div><div class="donate-text">If Genki Study Resources has helped you with your studies, please also consider <a href="'+getPaths()+"donate/"+s.local+'" target="_blank">making a donation <i class="fa">&#xf08e;</i></a> if you can, to help support the continued development and maintenance of these resources. Your support is greatly appreciated!</div></div></div></div>',zIndex:"low",focus:"#save-exercise-data"})},100)),localStorage.dataBackupReminderCount=s.dataBackupReminderCount)}"stroke"==t&&(a.getElementById("toggle-stroke-numbers").style.display="",a.getElementById("toggle-tracing-guide").style.display="none"),s.drake&&setTimeout(function(){s.drake.destroy(),delete s.drake},100);var p=a.getElementById("change-exercise-type-container");p&&(p.style.display="none"),a.getElementById("exercise").className+=" quiz-over",s.scrollTo("#complete-banner",!0)},reset:function(t){if(e.JSON){if(!t&&/fill-quiz|writing-quiz/.test(a.getElementById("exercise").className)&&s.stats.mistakes>0)return GenkiModal.open({title:'<span class="en">Try again with your current answers?</span><span class="ja">前の答えを保存してやり直しますか？</span>',content:'<div><span class="en">Would you like to try again with your current answers? This will allow you to correct the answers you got wrong while preserving what you have already written.</span><span class="ja">前の答えを保存してやり直しますか？不正解の答えを修正することができます。</span></div><br><div><span class="en">※ Please note that your answers will be lost if you change the page or exercise type.</span><span class="ja">※ページや練習型を変更すると、答えは失われますのでご注意ください。</span></div>',buttonHTML:'<span class="en">Yes</span><span class="ja">はい</span>',closeButtonText:'<span class="en">No</span><span class="ja">いいえ</span>',customButton:'<button id="genki-modal-cancel" class="button" onclick="GenkiModal.close();"><span class="en">Cancel</span><span class="ja">戻る</span></button>',keepOpen:!0,callback:function(){for(var e=[],t=a.querySelectorAll(".writing-zone-input"),i=0,n=t.length;i<n;i++)e.push(t[i].value);s.currentAnswers={type:/fill-quiz/.test(a.getElementById("exercise").className)?"fill":"writing",list:e},GenkiModal.close(),s.reset(!0)},closeCallback:function(){GenkiModal.close(),s.reset(!0)}});s.exerciseComplete=!1,s.quizOver=!1,s.isTouching=!1,s.textSelectMode=!1,s.strokeNumberDisplay=!1,s.markedItem=null,s.stats={problems:0,solved:0,mistakes:0,score:0,exclude:0},s.multiNodes&&delete s.multiNodes,s.timer.isRunning()&&s.timer.stop(),s.quickJisho.cache&&(!s.quickJisho.hidden&&s.quickJisho.toggle(),s.quickJisho.search(""),s.quickJisho.cache.search.value="");var i=a.getElementById("exercise"),n=a.querySelector(".multi-quiz-image");i.className="content-block",i.innerHTML=a.getElementById("exercise-title").outerHTML+'<div id="quiz-result"></div><div id="quiz-zone" class="clear"></div>'+(n?n.outerHTML:"")+'<div id="quiz-timer" class="center"></div>'+a.querySelector(".more-exercises").outerHTML,s.appendix?(i.style.display="none",a.getElementById("appendix-tool").style.display="",s.scrollTo(/\/dictionary\//.test(e.location)?"#practice-words":".title"),/\/dictionary\//.test(e.location)?s.appendix.jisho.launchExercise():/\/map-of-japan\//.test(e.location)?s.appendix.studyMap():/\/numbers-chart\//.test(e.location)?s.appendix.studyChart("numbers"):/\/conjugation-chart\//.test(e.location)&&s.appendix.studyChart("conjugation")):s.tools?(i.style.display="none",a.getElementById("study-tool-editor").style.display="",s.scrollTo(".title")):s.generateQuiz(JSON.parse(s.exerciseData))}else e.location.reload()},breakTime:function(){GenkiModal.open({title:'<span class="en">Take a Break?</span><span class="ja">休憩しますか？</span>',content:'<span class="en">Taking a break and waiting before trying again can greatly help with building your memory. 5 to 10 minute breaks are recommended, but you\'re free to adjust the time to your liking.'+(/"format":"vocab"/.test(s.exerciseData)?' Please see <a href="'+getPaths()+"help/vocab-memorization/"+s.local+'" target="_blank">this page</a> for more tips on memorizing vocab.':"")+'</span><span class="ja">休憩してからもう一度やってみると記憶力のために役立ちます。５、１０分の休憩がおすすめですが、お好みの時間が調整できます。'+(/"format":"vocab"/.test(s.exerciseData)?'単語を暗記するためのヒントには<a href="'+getPaths()+"help/vocab-memorization/"+s.local+'" target="_blank">このページ</a>をご覧ください。':"")+'</span><br><br><div class="center"><span class="en">Wait </span><span class="ja">待つ時間：</span><input id="break-minutes" class="center" type="number" value="'+s.breakTimer[s.breakMultiplier]+'" min="1" max="60" onchange="Genki.changeBreakMultiplier(this);"> <span class="en">Minute(s)</span><span class="ja">分</span></div>',buttonHTML:'<span class="en">Wait</span><span class="ja">待つ</span>',keepOpen:!0,callback:function(){if(s.breakMultiplier<s.breakTimer.length-1){if(2==s.breakMultiplier&&!s.breakTimerCustom){var t=a.getElementById("toggle-furigana");t&&1==/helper-present/.test(a.getElementById("quiz-zone").className)&&t.click()}s.breakMultiplier++}s.local||!s.canNotify||/denied|granted/.test(Notification.permission)||Notification.requestPermission();var i,n=+a.getElementById("break-minutes").value;n>60?n=60:n<=0&&(n=1),GenkiModal.open({title:'<span class="en">Taking a Break</span><span class="ja">休憩中</span>',content:'<div id="break-timer" class="center">00:'+(n<10?"0":"")+n+":00</div>",buttonHTML:'<span class="en">End Break Time</span><span class="ja">休憩を終了する</span>',keepOpen:!!(s.appendix||!s.tools&&/"format"/.test(s.exerciseData)),callback:function(){s.reset(),a.body.className=a.body.className.replace(" taking-a-break","")}}),a.body.className+=" taking-a-break",i=Math.floor(10*Math.random())+1,a.getElementById("genki-modal-overlay").style.backgroundImage="url(../../../resources/images/backgrounds/bg-"+(i<10?"0":"")+i+".jpg)";var l=new Timer,r=a.getElementById("break-timer");l.start({startValues:{minutes:n},target:{seconds:0},countdown:!0}),l.addEventListener("secondsUpdated",function(t){var i=l.getTimeValues().toString();if(r.innerHTML=i,"00:00:00"==i&&(r.innerHTML='<span class="en">Break time is up!</span><span class="ja">休憩が終了しました！</span><div style="font-size:15px;"><span class="en">Click the button below to resume your studies.</span><span class="ja">勉強を続けるために下のボタンをクリックしてください。</span></div>',a.getElementById("genki-modal-ok").style.display="inline-block",!s.local&&s.canNotify&&"granted"==Notification.permission)){new Notification(a.title.replace(/ \| Genki Study Resources.*$/,""),{body:"ja"==GenkiLang?"休憩が終了しました！":"Break time is up!",icon:a.querySelector('meta[property="og:image"]').content,tag:"breakTime-"+s.active.index}).onclick=function(){e.focus(),this.close()}}})}})},breakMultiplier:0,breakTimer:[5,10,15,20,30,40,50,60],breakTimerCustom:!1,changeBreakMultiplier:function(e){var a=Number(e.value);a<=5?s.breakMultiplier=0:a<=10?s.breakMultiplier=1:a<=15?s.breakMultiplier=2:a<=20?s.breakMultiplier=3:a<=30?s.breakMultiplier=4:a<=40?s.breakMultiplier=5:a<=50?s.breakMultiplier=6:a<=60&&(s.breakMultiplier=7),s.breakTimerCustom=!0},review:function(){GenkiModal.open({title:'<span class="en">Activate Review Mode?</span><span class="ja">単語を復習しますか？</span>',content:'<span class="en">Are you sure you want to review? Your current progress will be lost.</span><span class="ja">今までの進み具合は失われます。よろしいですか？</span>',callback:function(){for(var t=a.querySelectorAll("[data-answer]"),i=0,n=t.length;i<n;i++)a.querySelector('[data-text="'+t[i].dataset.answer+'"]').appendChild(t[i]);s.timer.stop(),s.drake.destroy(),a.getElementById("quiz-timer").style.display="none",a.getElementById("review-exercise").innerHTML=(/\/dictionary\//.test(e.location)?s.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i><span class="en">Restart</span><span class="ja">リセットする</span></button>')+(a.querySelector(".drag-quiz")?s.lang.toggle_furigana+a.getElementById("toggle-orientation").outerHTML:""),a.getElementById("quiz-info").innerHTML='<span class="en">You are currently in review mode; go ahead and take your time to study. When you are ready to practice this exercise, click the "restart" button.</span><span class="ja">復習モードになっていますので、ゆっくり勉強してください。復習し終わったら「リセットする」をクリックしてください。</span>',a.getElementById("quiz-zone").className+=" review-mode";var l=a.getElementById("change-exercise-type-container");l&&(l.style.display="none")}})},toHalfWidth:function(e){return e.replace(/[\uFF01-\uFF5E]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})},check:{busy:!1,value:function(t){if(s.check.busy||t.value!=t.dataset.answer)s.check.busy&&e.setTimeout(function(){s.check.busy=!1,a.activeElement&&a.activeElement.value&&a.activeElement.value==s.input.map[s.input.index-1].value&&(a.activeElement.value="")},10);else{s.check.busy=!0;var i=s.input.map[s.input.index+1];i?i.focus():e.setTimeout(function(){t.blur(),s.check.answers(!0),s.check.busy=!1},10)}},answers:function(e,t){!s.exerciseComplete&&GenkiModal.open({title:'<span class="en">Check Answers?</span><span class="ja">答え合わせをしますか？</span>',content:e?'<span class="en">The last input field has been filled in. Are you ready to check your answers?</span><span class="ja">最後の入力欄が入力されました。答え合わせをしてもよろしいですか？</span>':'<span class="en">Checking your answers will end the quiz. Do you want to continue?</span><span class="ja">答え合わせをするとテストが終了します。よろしいですか？</span>',buttonHTML:'<span class="en">Yes, check my answers!</span><span class="ja">はい、答え合わせをしよう！</span>',callback:function(){if(s.exerciseComplete=!0,a.querySelector("#check-answers button").style.display="none",t&&"drawing"==t)for(var e,i=0,n=(d=a.querySelectorAll(".kanji-canvas")).length;i<n;i++)e=KanjiCanvas.recognize(d[i].id),s.debug&&console.log("toDraw: "+d[i].dataset.kanji),s.debug&&console.log("Results: "+e),s.debug&&console.log("Correct: "+(new RegExp(d[i].dataset.kanji).test(e)&&d[i].dataset.strokesAnswer==d[i].dataset.strokes).toString()),new RegExp(d[i].dataset.kanji).test(e)&&d[i].dataset.strokesAnswer==d[i].dataset.strokes?d[i].dataset.answer=!0:(d[i].dataset.answer=!1,++s.stats.mistakes),++s.stats.solved;else{var l,r,o,c,d,p,u=a.querySelectorAll("#exercise .writing-zone-input");for(i=0,n=u.length;i<n;i++){r=!1,c=u[i].dataset,o=s.toHalfWidth(u[i].value).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,"");for(l in c)if(/answer/.test(l)){if(d=s.toHalfWidth(c[l]).toLowerCase().replace(/。|、|^\s+|\s+$|\n/g,""),/%\(.*?\)/.test(d))for(p=d.replace(/.*?%\((.*?)\).*/,"$1").split("/");p.length;){if(o==d.replace(/%\(.*?\)/,p[0])){r=!0;break}p.splice(0,1)}else o==d&&(r=!0);if(r)break}r?u[i].parentNode.className+=" answer-correct":(++c.mistakes,++s.stats.mistakes,"fill"==t&&u[i].parentNode.insertAdjacentHTML("beforeend",('<span class="problem-answer">'+c.answer+(c.answer2||c.furigana?'<span class="secondary-answer'+(c.furigana?" furigana-only":"")+'">'+(c.answer2||c.furigana)+"</span>":"")+"</span>").replace(/%\((.*?)\)/g,function(e,a){return'<span class="alt-phrase">(</span>'+a.replace(/\//g,'<span class="alt-phrase-sep">/</span>')+'<span class="alt-phrase">)</span>'}))),++s.stats.solved,u[i].disabled=!0}}s.endQuiz(t||s.QuizType.WRITING)}})}},toggle:{exerciseList:function(e){e.className="list-open"==e.className?"":"list-open"},list:function(e){var a="lesson-title",s=a+" lesson-open";e.className=e.className==s?a:s;for(var t=e.parentNode.querySelectorAll(".lesson-title"),i=0,n=t.length;i<n;i++)t[i]!=e&&(t[i].className=a)},furigana:function(e){var t=a.getElementById("quiz-zone"),i=storageOK&&localStorage.furiganaVisible||(/helper-hidden/.test(t.className)?"false":"true");switch(i){case"true":i="false",t.className=t.className.replace("helper-present","helper-hidden"),e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示");break;case"false":i="true",t.className=t.className.replace("helper-hidden","helper-present"),e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示")}s.lang.toggle_furigana=e.outerHTML,storageOK&&(localStorage.furiganaVisible=i)},vocabSpoiler:function(e){var a=e.nextSibling;/spoiler-off/.test(a.className)?(a.className=a.className.replace("spoiler-off",""),e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示")):(a.className+=" spoiler-off",e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示"))},vocabOrientation:function(e,s){var t=a.getElementById("quiz-zone"),i=void 0!==s?s:storageOK&&localStorage.vocabHorizontal||(/vocab-horizontal/.test(t.className)?"true":"false"),n=a.querySelectorAll(".quiz-answer-zone"),l=0,r=n.length;switch(i){case"true":i="false",t.className=t.className.replace(" vocab-horizontal",""),e.innerHTML=e.innerHTML.replace("Vertical","Horizontal").replace("垂直","水平"),e.querySelector("i").style.transform="rotate(90deg)";for(var o=a.getElementById("drop-list");l<r;l++)o.appendChild(n[l]);break;case"false":i="true",t.className+=" vocab-horizontal",e.innerHTML=e.innerHTML.replace("Horizontal","Vertical").replace("水平","垂直"),e.querySelector("i").style.transform="rotate(0deg)";for(var c=a.querySelectorAll(".quiz-item-group");l<r;l++)c[l].appendChild(n[l])}storageOK&&!s&&(localStorage.vocabHorizontal=i)},strokeNumbers:function(e){a.getElementById("quiz-zone");switch(s.strokeNumberDisplay){case!0:s.strokeNumberDisplay=!1,e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示");break;case!1:s.strokeNumberDisplay=!0,e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示")}for(var t=a.querySelectorAll(".kanji-canvas"),i=0,n=t.length;i<n;i++)KanjiCanvas["canvas_"+t[i].id]&&KanjiCanvas.redraw(t[i].id,!1,s.strokeNumberDisplay)},strokeOrder:function(e){var s=a.getElementById("quiz-zone"),t=storageOK&&localStorage.strokeOrderVisible||(/stroke-order-hidden/.test(s.className)?"false":"true");switch(t){case"true":t="false",s.className=s.className+=" stroke-order-hidden",e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示");break;case"false":t="true",s.className=s.className.replace(" stroke-order-hidden",""),e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示")}storageOK&&(localStorage.strokeOrderVisible=t)},tracingGuide:function(e,s){a.getElementById("quiz-zone");var t=storageOK&&localStorage.tracingGuideVisible?localStorage.tracingGuideVisible:"true";switch(t){case"true":t="false",e.innerHTML=e.innerHTML.replace("Hide","Show").replace("非表示","表示");break;case"false":t="true",e.innerHTML=e.innerHTML.replace("Show","Hide").replace("表示","非表示")}var i=a.querySelectorAll(".kanji-canvas"),n=0,l=i.length;if(s)for(var r=0,o="";n<l;n++)i[n].dataset.kanji!=o&&(o=i[n].dataset.kanji,r=0),r++<3&&(i[n].dataset.guide=t,KanjiCanvas["canvas_"+i[n].id]&&KanjiCanvas.redraw(i[n].id,!0));else for(;n<l;n++)i[n].dataset.guide=t,KanjiCanvas["canvas_"+i[n].id]&&KanjiCanvas.redraw(i[n].id,!0);storageOK&&(localStorage.tracingGuideVisible=t)},textSelection:function(e){var t=a.getElementById("quiz-zone");switch(s.textSelectMode){case!0:s.textSelectMode=!1,t.className=t.className.replace(" text-selection-mode",""),e.innerHTML=e.innerHTML.replace("Dis","En").replace("無","有");break;case!1:s.textSelectMode=!0,t.className=t.className+=" text-selection-mode",e.innerHTML=e.innerHTML.replace("En","Dis").replace("有","無")}}},create:{exerciseButtons:function(){for(var e,t='<div class="more-exercises clear">',i=2;i-- >0;)(e=s.exercises[1==i?s.active.index-1:s.active.index+1])&&!/^\.\.\//.test(e)&&(e=e.split("|"),t+='<a href="../../../'+s.ed+"/"+e[0]+"/"+s.local+s.debug+'" class="button '+(1==i?"prev":"next")+'-ex" title="'+(1==i?"Previous":"Next")+' exercise">'+e[1]+"</a>");a.getElementById("quiz-timer").insertAdjacentHTML("afterend",t+"</div>")},removeExerciseList:function(){var e=a.getElementById("exercise-list"),s=a.getElementById("toggle-exercises");e&&e.parentNode.removeChild(e),s&&s.parentNode.removeChild(s)},exerciseList:function(){var t='<div id="link-list" class="normal-block indent-block"><div><a id="link-home" class="button" href="'+getPaths()+(storageOK&&"3rd"==localStorage.GenkiEdition?"lessons-3rd/":"")+s.local+'"><i class="fa">&#xf015;</i><span class="en">Home</span><span class="ja">トップページ</span></a></div><div><a id="link-grammar" href="'+getPaths()+"lessons-3rd/appendix/grammar-index/"+s.local+'"><i class="fa">&#xf02d;</i><span class="en">Grammar Index</span><span class="ja">文法索引</span></a></div><div><a id="link-anki" href="'+getPaths()+"help/anki-decks/"+s.local+'"><i class="fa">&#xf005;</i><span class="en">Anki Decks</span><span class="ja">Ankiのデッキ</span></a></div><div><a id="link-help" href="'+getPaths()+"help/"+s.local+'"><i class="fa">&#xf059;</i><span class="en">Help &amp; FAQ</span><span class="ja">FAQ</span></a></div><div><a id="link-report" href="'+getPaths()+"report/"+s.local+'"><i class="fa">&#xf188;</i><span class="en">Reports &amp; Feedback</span><span class="ja">フィードバックを送る</span></a></div><div><a id="link-download" href="'+getPaths()+"download/"+s.local+'"><i class="fa">&#xf019;</i><span class="en">Download</span><span class="ja">ダウンロードする</span></a></div><div><a id="link-donate" href="'+getPaths()+"donate/"+s.local+'"><i class="fa">&#xf004;</i><span class="en">Donate</span><span class="ja">支援する</span></a></div><div><a id="link-github" href="https://github.com/SethClydesdale/genki-study-resources"><i class="fa">&#xf09b;</i>GitHub</a></div><div><a id="link-settings" href="#genki-site-settings" onclick="GenkiSettings.manager(); return false;"><i class="fa">&#xf013;</i><span class="en">Settings</span><span class="ja">設定</span></a></div></div><div id="related" class="indent-block"><h3><span class="en">Related Projects</span><span class="ja">関連のプロジェクト</span></h3><a href="https://sethclydesdale.github.io/tobira-study-resources/" title="Tobira Study Resources"><img src="'+getPaths()+'resources/images/tobira-img.png" alt="Tobira Study Resources"></a><a href="https://sethclydesdale.github.io/quartet-study-resources/" title="Quartet Study Resources"><img src="'+getPaths()+'resources/images/quartet-img.png" alt="Quartet Study Resources"></a><a href="https://sethclydesdale.github.io/colloquial-kansai-dictionary/" title="Colloquial Kansai Japanese"><img src="'+getPaths()+'resources/images/kansai-img.png" alt="Colloquial Kansai Japanese"></a></div>';if(s.exercises){var i,n,l,r='class="lesson-title" onclick="Genki.toggle.list(this);" onkeydown="event.key == \'Enter\' && Genki.toggle.list(this);" tabindex="0"',o='<nav id="exercise-list"><h3 class="main-title"><span class="en">Exercise List</span><span class="ja">練習問題一覧</span></h3><button id="random-exercise" class="button" onclick="Genki.randomExercise();" title="'+("ja"==GenkiLang?"ランダム練習":"Random Exercise")+'"><i class="fa">&#xf074;</i></button><div id="lessons-list"><h4 '+r+'><span class="en">Page Links</span><span class="ja">ページリンク</span></h4><ul id="page-links">'+t+"</ul>",c="\\.\\.\\/",d=0,p=s.exercises.length,u="",g=/workbook-\d+|literacy-\d+|literacy-wb-\d+/,h={workbook:"Workbook",literacy:"Reading and Writing","literacy-wb":"Workbook: Reading and Writing"};if(storageOK&&(localStorage.GenkiEdition=/lessons-3rd/.test(e.location.pathname)?"3rd":"2nd",!localStorage.Results||!new RegExp(localStorage.GenkiEdition).test(localStorage.Results))){var m=localStorage.Results?JSON.parse(localStorage.Results):{};m[localStorage.GenkiEdition]={},localStorage.Results=JSON.stringify(m)}for(;d<p;d++){l=(i=s.exercises[d].split("|"))[0].replace(/^lesson-\d+\/|-\d+$/g,""),new RegExp(c).test(i[0])||(o+="</ul><h4 "+r+">"+(c=/^appendix/.test(i[0])?"appendix":/^study-tools/.test(i[0])?"study-tools":i[0].replace(/(lesson-\d+)\/.*/,"$1")).charAt(0).toUpperCase()+c.replace(/-/," ").slice(1)+'</h4><ul id="'+c+'">',u=""),g.test(i[0])&&u!=l&&(o+='<li><h4 class="sub-lesson-title">'+h[u=l]+"</h4></li>");var k=JSON.parse(localStorage.Results)[localStorage.GenkiEdition],f=k?parseInt(k[i[0]]):null,v="ja"==GenkiLang?"テストの得点":"Exercise score",b=f>-1?(100==f?'<span class="exercise-results result--perfect" title="'+v+'"><i class="fa">&#xf005;</i> ':f>=70?'<span class="exercise-results result--good" title="'+v+'"><i class="fa">&#xf00c;</i> ':f>=50?'<span class="exercise-results result--average" title="'+v+'"><i class="fa">&#xf10c;</i> ':'<span class="exercise-results result--low" title="'+v+'"><i class="fa">&#xf00d;</i> ')+f+"%</span>":"";o+='<li class="menu-item-list"><a href="'+("\\.\\.\\/"==c?i[0]:"../../../"+s.ed+"/"+i[0]+"/")+s.local+s.debug+'" '+(i[2]?'data-page="Genki '+(+i[0].replace(/lesson-(\d+).*/,"$1")<13?"I":"II")+(/workbook-|wb-/.test(i[0])?" Workbook":"")+": "+i[2]+'"':"")+' title="'+i[1]+'">'+i[1]+"</a> "+b+"</li>"}a.getElementById("content").insertAdjacentHTML("afterbegin",'<a href="#toggle-exercises" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="'+("ja"==GenkiLang?"練習問題一覧をトグルする":"Toggle exercise list")+'"></a>'+o+"</ul></div></nav>"),s.active.exercise&&(s.toggle.list(a.getElementById(/^appendix/.test(s.active.exercise[0])?"appendix":/^study-tools/.test(s.active.exercise[0])?"study-tools":s.active.exercise[0].replace(/(lesson-\d+)\/.*/,"$1")).previousSibling),(n=a.querySelector('a[href*="'+s.active.exercise[0]+'"]:not(#link-grammar)')).className+=" active-lesson",n=n.parentNode,a.getElementById("lessons-list").scrollTop=n.offsetTop-(n.getBoundingClientRect().height+(e.matchMedia&&matchMedia("(pointer:coarse)").matches?0:6)))}else{var y='<a href="#toggle-navigation" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="'+("ja"==GenkiLang?"クイックナビゲーションをトグルする":"Toggle quick navigation")+'"></a><nav id="exercise-list"><h3 class="main-title"><span class="en">Quick Navigation</span><span class="ja">クイックナビゲーション</span></h3><div id="lessons-list">'+t+"</div></nav>";a.getElementById("content").insertAdjacentHTML("afterbegin",y)}},exerciseTypeButton:function(){var t=a.getElementById("quiz-timer"),i=a.createElement("DIV"),n=a.createElement("BUTTON");i.id="change-exercise-type-container",i.className="center",n.id="change-exercise-type",n.className="button",n.innerHTML='<i class="fa">&#xf021;</i> <span class="en">Change Exercise Type</span><span class="ja">練習型を変更する</span>',n.onclick=function(){GenkiModal.open({title:'<span class="en">Change Exercise Type?</span><span class="ja">練習型を変更しますか？</span>',content:'<span class="en">To change the exercise type, you must quit the current exercise. Do you want to quit?</span><span class="ja">練習型を変更するためにテストが終了しなければいけません。よろしいですか？</span>',buttonHTML:'<span class="en">Quit</span><span class="ja">終了する</span>',closeButtonText:'<span class="en">Cancel</span><span class="ja">戻る</span>',keepOpen:!!(/\/dictionary\//.test(e.location)||!s.tools&&/"format"/.test(s.exerciseData)),callback:function(){if(/(?:begin|start)=\d/.test(e.location.search)){if(!e.history||!e.history.pushState)return void(e.location.search="");e.history.pushState({},a.title,e.location.href.replace(e.location.search,"")+s.debug)}s.changingExType=!0,s.reset()}})},i.appendChild(n),t.nextSibling?t.parentNode.insertBefore(i,t.nextSibling):t.parentNode.appendChild(i)}},parse:{image:function(e){var a=/^http/.test(e[1])?e[1]:"../../../resources/images/lesson-images/"+e[1];return'<a href="'+a+'" target="blank" title="'+("ja"==GenkiLang?"画像の全体を見る":"View full image")+'" class="lesson-image"><img src="'+a+'" alt="'+(e[2]||e[1])+'" /></a>'}},quickJisho:{hidden:!0,selectorHidden:!0,tabbing:!1,create:function(){if(!s.quickJisho.cache){var e=a.createElement("DIV"),t=a.createElement("DIV"),i=a.createElement("BUTTON"),n=a.createDocumentFragment();e.id="quick-jisho-toggle",e.innerHTML='<i class="fa">&#xf02d;</i>',e.title="ja"==GenkiLang?"クイック辞書をトグルする":"Toggle Quick Dictionary",e.tabIndex=0,e.onclick=s.quickJisho.toggle,e.onkeypress=function(e){"Enter"==e.key&&s.quickJisho.toggle()},t.id="quick-jisho-window",t.className="quick-jisho-hidden",t.innerHTML='<div class="quick-jisho-header"><h3 id="quick-jisho-title" class="main-title"> <span class="en">Quick Dictionary</span><span class="ja">クイック辞書</span> <span id="quick-jisho-hits"></span> </h3> <i class="fa fa-hover" tabindex="0" onclick="Genki.quickJisho.toggle();" onkeydown="event.key == \'Enter\' && Genki.quickJisho.toggle();" title="'+("ja"==GenkiLang?"最小化":"Minimize")+'">&#xf2d1;</i>  </div><div id="quick-jisho-content"><div class="quick-jisho-row center"><input tabindex="0" id="quick-jisho-search" type="text" placeholder="'+("ja"==GenkiLang?"探す…":"Search...")+'" oninput="Genki.quickJisho.search(this.value);"></div><div class="quick-jisho-row"><ul id="quick-jisho-results"></ul></div></div>',i.id="quick-jisho-selector",i.className="button",i.style.display="none",i.innerHTML='<i class="fa">&#xf002;</i><span class="en">Look up</span><span class="ja">辞書で調べる</span>',i.onclick=s.quickJisho.lookUp,i.tabIndex=0,n.appendChild(t),n.appendChild(e),n.appendChild(i),a.body.appendChild(n);a.querySelector(".footer-right").style.marginRight="40px",s.quickJisho.cache={box:t,search:a.getElementById("quick-jisho-search"),results:a.getElementById("quick-jisho-results"),hits:a.getElementById("quick-jisho-hits"),selector:a.getElementById("quick-jisho-selector")},a.onselectionchange=s.quickJisho.getSelection,a.onmousemove=function(e){s.quickJisho.x=Math.abs(e.pageX-a.body.clientWidth)<100?e.pageX-95:e.pageX,s.quickJisho.y=Math.abs(e.pageY-a.body.clientHeight)<40?e.pageY-32:e.pageY+12},a.onkeydown=function(e){"Tab"!=e.key||s.quickJisho.selectorHidden||a.activeElement==s.quickJisho.cache.selector||(s.quickJisho.tabbing=!0,s.quickJisho.cache.selector.focus(),e.preventDefault())}}},toggle:function(){if(!s.jisho&&!s.quickJisho.loading){s.quickJisho.loading=!0;var e=a.createElement("SCRIPT");e.src=getPaths()+"resources/javascript/jisho.min.js",e.onload=function(){s.quickJisho.cache.search.value&&s.quickJisho.search(s.quickJisho.cache.search.value),s.quickJisho.loading=!1},a.body.appendChild(e)}s.quickJisho.hidden?(s.quickJisho.cache.box.className="",s.quickJisho.hidden=!1,s.quickJisho.cache.search.focus()):(s.quickJisho.cache.box.className="quick-jisho-hidden",s.quickJisho.hidden=!0)},search:function(a,t){s.quickJisho.searchTimeout&&e.clearTimeout(s.quickJisho.searchTimeout),s.quickJisho.searchTimeout=e.setTimeout(function(){var e,i,n,l,r,o="",c=0;if(s.quickJisho.cache.results.innerHTML="",a){a=a.toLowerCase();for(e in s.jisho)for(i=0,n=s.jisho[e].length;i<n;i++)for(l in s.jisho[e][i])if(-1!=s.jisho[e][i][l].toLowerCase().indexOf(a)){o+='<li tabindex="0" class="definition clear"><span class="def-ja'+((r=s.jisho[e][i].ja.split("|"))[1]?" def-furi":"")+'">'+r[0]+(r[1]?"<i>"+r[1]+"</i>":"")+'</span><span class="def-en">'+s.jisho[e][i].en+"</span>"+(s.jisho[e][i].v?' <span class="def-vtype">[<i>'+s.jisho[e][i].v+"</i>]</span>":"")+'<span class="def-label">'+s.jisho[e][i].l+"</span>",c++;break}}if(!t&&!o&&a&&/[\u3400-\u9faf]/.test(a)){var d=a.match(/[\u3400-\u9faf]+/);d&&d[0]&&s.quickJisho.search(d[0],!0)}else s.quickJisho.cache.results.innerHTML=o||(a?'<li><span class="en">No results found for "'+a+'".</span><span class="ja">「'+a+"」が見つかりませんでした。</span></li>":""),s.quickJisho.cache.hits.innerHTML=c?"("+c+")":"";delete s.quickJisho.searchTimeout},300)},lookUp:function(){s.quickJisho.hidden&&s.quickJisho.toggle(),s.quickJisho.cache.search.value="".trim?s.quickJisho.selectedText.trim():s.quickJisho.selectedText,s.quickJisho.search(s.quickJisho.cache.search.value),this.style.display="none",s.quickJisho.selectorHidden=!0},getSelection:function(){if(storageOK&&"false"==localStorage.genkiJishoLookUp)return!1;if(s.quickJisho.tabbing)return s.quickJisho.tabbingOff||(s.quickJisho.tabbingOff=setTimeout(function(){s.quickJisho.tabbing=!1,delete s.quickJisho.tabbingOff},10)),!1;if(a.getSelection){var e=a.getSelection();"Range"==e.type&&e.toString&&!/quick-jisho/.test(e.focusNode.className)?(s.quickJisho.selectedText=e.toString(),s.quickJisho.cache.selector.style.left=s.quickJisho.x+"px",s.quickJisho.cache.selector.style.top=s.quickJisho.y+"px",s.quickJisho.selectorHidden&&(s.quickJisho.cache.selector.style.display="",s.quickJisho.selectorHidden=!1)):(s.quickJisho.selectedText="",s.quickJisho.selectorHidden||(s.quickJisho.cache.selector.style.display="none",s.quickJisho.selectorHidden=!0))}}},playAudio:function(e,s){var t=a.getElementById(e);t&&(t.currentTime=s,t.play())},viewStrokeOrder:function(e,a,s){var t=getPaths()+"resources/images/stroke-order/"+a+".png";GenkiModal.open({title:e+'<span class="en"> Stroke Order</span><span class="ja">の書き順</span>',content:'<div class="kanji-stroke-order center"><div class="big-kanji'+(s?" kana-font":"")+'"'+(/り/.test(e)?' style="font-family:SawarabiGothic, MS Gothic, Yu Gothic, NotoSansJP, Meiryo;"':"")+">"+e+'</div><a class="button-link" href="'+(s?getPaths()+"resources/images/stroke-order/sasagami-"+s+".jpg":"https://jisho.org/search/"+e+"%20%23kanji")+'" target="_blank" title="'+("ja"==GenkiLang?"jisho.orgで書き順を見る":"View stroke order on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a><a href="'+t+'" target="_blank" title="'+("ja"==GenkiLang?"クリックして画像を見る":"Click to view image")+'"><img src="'+t+'" alt="'+("ja"==GenkiLang?"書き順":"stroke order")+'"/></a></div>'})},getAlts:function(e,a,t){for(var i,n,l,r,o=a.split("|"),c=o.length,d=Math.pow(2,c),p=[],u=0;u<d;++u)n=0,r=e.replace(/\{(.*?)\}/g,function(e,a){return l=n++,1<<(i=c-1-l)&u?o[l]:a}),p.push(r);if(s.debug){var g=p.length;console[g/d*100==100?"log":"warn"](g+"/"+d+" ("+g/d*100+"% combo coverage for "+c+" replacements; "+(d-g)+" missing combos)",p)}return t?p:"%("+p.join("/")+")|"},getGrammarPoint:function(e,t){for(var i=e.parentNode;i;){if("genki-modal-content"==i.id){s.grammarPointHistory.push(i.innerHTML);break}if("BODY"==i.tagName||!i)break;i=i.parentNode}GenkiModal.open({title:"Quick Grammar Review",content:'<div id="appendix-tool" class="loading"></div>',customButton:(s.grammarPointHistory.length?'<button id="genki-modal-back" class="button" onclick="Genki.grammarPointBack(this);" title="Go back to previous grammar point."><i class="fa">&#xf112;</i><span class="en">Back</span><span class="ja">先の文法ノートに戻る</span></button>':"")+'<a href="'+e.href+'" class="button" target="_blank"><i class="fa">&#xf08e;</i><span class="en">View in Grammar Index</span><span class="ja">文法索引で見る</span></a>',customSize:{top:"10%",left:"20%",bottom:"10%",right:"20%"},zIndex:"low",closeCallback:function(){s.grammarPointHistory=[]}}),Get(e.href,function(i){var n=a.querySelector("#genki-modal #appendix-tool"),l=i.match(new RegExp('(<h3 id="'+t+'"[\\s\\S]*?</table><br>)',"m")),r=e.href.replace(/#.*$/,"");l&&l[0]?n&&(n.innerHTML=l[0].replace(/\d+\. /,"").replace(/href="#(.*?)"/g,'onclick="Genki.getGrammarPoint(this, \'$1\'); return false;" target="_blank" href="'+r+'#$1"'),n.className="grammar-index "+("lessons"==s.ed?"second-ed":"third-ed")):n&&(n.innerHTML='<br><b><span class="en">Failed to retrieve grammar point. Click "View in Grammar Index" to try viewing the grammar point directly.</span><span class="ja">文法ノートが見つかりませんでした。「文法索引で見る」をクリックして文法索引で見てみます。</span></b>',n.className="center")})},grammarPointHistory:[],grammarPointBack:function(e){if(s.grammarPointHistory.length){var t=a.getElementById("genki-modal-content");t.innerHTML=s.grammarPointHistory.pop(),t.scrollTop=0,s.grammarPointHistory.length||(e.style.display="none")}},randomExercise:function(){if(storageOK&&"lesson"==localStorage.genkiRandomExercise&&/lesson-\d+/.test(e.location.href))var a=new RegExp(e.location.href.replace(/.*?(lesson-\d+).*/,"$1/")),t=s.exercises.filter(function(e){return a.test(e)});else if(storageOK&&"completed"==localStorage.genkiRandomExercise&&localStorage.Results&&JSON.parse(localStorage.Results)[localStorage.GenkiEdition]){var i=JSON.parse(localStorage.Results)[localStorage.GenkiEdition];if(!(t=s.exercises.filter(function(e){return e.split("|")[0]in i}))[0])return alert("ja"==GenkiLang?"完成した練習が足りませんのでランダム練習はできません。":"Cannot select a random exercise, because you have not completed enough exercises yet.")}else if(storageOK&&"custom"==localStorage.genkiRandomExercise&&GenkiRandomList.length)t=GenkiRandomList;else t=s.exercises;var n=t[Math.floor(Math.random()*t.length)].split("|");/lesson-\d+/.test(n[0])?e.location.href="../../../"+s.ed+"/"+n[0]+"/"+s.local+s.debug:s.randomExercise()},startOrPauseTimerByVisibility:function(){a.hidden&&s.timer.isRunning()?s.timer.pause():a.hidden||!s.timer.isPaused()||s.isTimerPausedByPopup||s.timer.start()},pauseTimerWhenOpenPopup:function(){s.timer.pause(),s.isTimerPausedByPopup=!0},startTimerWhenClosePopup:function(){s.timer.start(),s.isTimerPausedByPopup=!1},init:function(){if(s.exercises){for(var t,i=0,n=s.exercises.length,l=a.getElementById("quiz-result");i<n;i++)if(s.active.path==s.exercises[i].split("|")[0]){s.active.exercise=s.exercises[i]?s.exercises[i].split("|"):null,s.active.index=i;break}s.active.exercise?(t=/^appendix/.test(s.active.exercise[0])?"appendix":/^study-tools/.test(s.active.exercise[0])?"study-tools":+s.active.exercise[0].replace(/lesson-(\d+).*/,"$1"),l.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center" '+(s.active.exercise[2]?'data-page="Genki '+(t<13?"I":"II")+(/workbook-|wb-/.test(s.active.exercise[0])?" Workbook":"")+": "+s.active.exercise[2]+'"':"")+">"+("appendix"==t?"巻末":"study-tools"==t?"ツール":"第"+t+"課")+" - "+s.active.exercise[1]+"</h2>")):l.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center">'+a.querySelector("TITLE").innerText.replace(/\s\|.*/,"")+"</h2>"),s.isTouch&&(a.ontouchstart=function(){s.isTouching=!0},a.addEventListener("touchmove",function(e){s.isTouching&&/hidden/i.test(a.body.style.overflow)&&e.preventDefault()},{passive:!1}),a.ontouchend=function(){s.isTouching=!1},a.ontouchcancel=function(){s.isTouching=!1}),s.create.exerciseButtons()}s.create.exerciseList(),e.Genki=this}};e.onbeforeunload=function(){var e=!1,t=a.getElementById("exercise");if(t){if(t=t.className,/quiz-over/.test(t)||a.querySelector(".review-mode"))e=!1;else if(/fill-quiz|writing-quiz/.test(t)){for(var i=0,n=(l=a.querySelectorAll(".writing-zone-input")).length;i<n;i++)if(""!=l[i].value){e=!0;break}}else if(/drawing-quiz|stroke-quiz/.test(t)){var l;for(i=0,n=(l=a.querySelectorAll(".kanji-canvas")).length;i<n;i++)if(KanjiCanvas["recordedPattern_"+l[i].id].length){e=!0;break}}else/multi-quiz|drag-quiz|kana-quiz/.test(t)&&s.stats.solved>0&&(e=!0);if(e)return"ja"==GenkiLang?"進み具合は失われます。よろしいですか？":"Your progress will be lost. Do you want to continue?"}},s.init()}(window,document);