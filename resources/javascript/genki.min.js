(function(window,document){"use strict";var Genki={stats:{problems:0,solved:0,mistakes:0,score:0,exclude:0},canNotify:"Notification"in window,isTouch:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,isTouching:false,isTimerPausedByPopup:false,feedbackMode:storageOK&&localStorage.feedbackMode?localStorage.feedbackMode:"classic",textSelectMode:false,strokeNumberDisplay:false,markedItem:null,ed:"lessons"+(/lessons-3rd/.test(window.location.pathname)?"-3rd":""),local:window.location.protocol=="file:"?"index.html":"",debug:/debug/.test(window.location.search)?"?debug":"",lang:{std_drag:"Drag the English expression to the Japanese expression that has the same meaning.<br>TIP: Click an expression to mark it, then click an empty field to drop the answer there.",std_kana:"Drag the Kana to the matching Romaji.<br>TIP: Click the kana to mark it, then click an empty field to drop the answer there.",std_num:"Drag the Numbers to the matching Kana.<br>TIP: Click a number to mark it, then click an empty field to drop the answer there.",std_multi:"Solve the problems by choosing the correct answers.",std_questions:"Answer the questions as best as you can.",std_culture:"Answer the questions about Japanese culture as best as you can.",std_stroke_order:"Practice drawing each kanji by following the stroke order.",std_drawing:"Practice drawing the following kanji multiple times.",vocab_multi:"Choose the correct definition for each Japanese expression.",vocab_writing:"Practice spelling the following words/expressions.",vocab_fill:"Write the Japanese definition for the following words/expressions.",kana_multi:"Choose the correct Romaji for the %{KANA}.",kana_writing:"Practice writing the following %{KANA}.",kana_fill:"Complete the chart by filling in the Romaji.",num_multi:"Read the Japanese and choose the correct numbers.",num_writing:"Practice spelling the following numbers.",num_fill:"Write the following numbers in Japanese (hiragana).",kanji_readings_multi:"Choose the correct readings for each kanji.",kanji_readings_drag:"Match each kanji with their readings.",kanji_yomikata:'</div><p class="text-block" style="margin:10px 0;">▶ indicates the <em>on-yomi</em> (pronunciation originally borrowed from Chinese).<br>▷ indicates the <em>kun-yomi</em> (native Japanese reading).</p>',kanji_meanings_multi:"Choose the correct meanings for each kanji.",kanji_meanings_drag:"Match each kanji with their meanings.",opts:{kana:{kana:"Drag and Drop",multi:"Multiple Choice",writing:"Writing Practice",fill:"Fill in the Chart"},numbers:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Numbers"},kanji:{multi:"Multiple Choice",drag:"Drag and Drop"},vocab:{drag:"Drag and Drop",multi:"Multiple Choice",writing:"Spelling Practice",fill:"Write the Definition"},practice:{multi:"Multiple Choice",fill:"Written",drag:"Drag and Drop"},hirakata:{fill:"Written",stroke:"Stroke Order Practice",drawing:"Drawing Practice"}},mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong before finding the correct answer. Review these problems before trying again.',writing_mistakes:'The items outlined in <span class="t-red t-bold">red</span> were answered wrong. Review these problems before trying again.',multi_mistakes:'The answers you selected that were wrong are outlined in <span class="t-red t-bold">red</span>. The correct answers are outlined in <span class="t-blue t-bold">blue</span>. Review these problems before trying again.',stroke_mistakes:'The characters you drew that were wrong are outlined in <span class="t-red t-bold">red</span>. Please review the stroke order and number of strokes for these characters before trying again.<br><br><b>Note:</b> Sometimes answers may be marked wrong by mistake, due to a mismatch in the recognition algorithm.<br>Please use your own discretion if this occurs.',fill_mistakes:'The items underlined in <span class="t-red t-bold">red</span> were answered wrong, the correct answers are listed underneath in <span class="t-green t-bold">green</span>. Review these problems before trying again.',sub_answers:'<b>Note:</b> Answers inside <span class="t-blue t-bold">blue</span> parentheses separated by "<span class="alt-phrase-sep">/</span>" are a list of possible sub-answers; only one can be used.<br>For example.. <span class="t-green"><span class="alt-phrase">(</span>あの<span class="alt-phrase-sep">/</span>その<span class="alt-phrase">)</span>ねこ</span>: そのねこ or あのねこ <span class="t-green">(good)</span> vs あの/そのねこ <span class="t-red">(bad)</span><br><span class="t-green"><span class="alt-phrase">(</span>この<span class="alt-phrase-sep">/</span><span class="alt-phrase">)</span>ねこ</span> means the sub-answer is optional; it can be left out.',review:'<div id="review-exercise" class="center clearfix"><button id="review-button" class="button" onclick="Genki.review();"><i class="fa">&#xf02d;</i>Review</button></div>',toggle_furigana:'<button id="toggle-furigana" class="button" onclick="Genki.toggle.furigana(this);"><i class="fa">&#xf2a8;</i>'+(storageOK&&localStorage.furiganaVisible=="false"?"Show":"Hide")+" Furigana</button>",check_answers:'<div id="check-answers" class="center"><button id="check-answers-button" class="button" onclick="Genki.check.answers();"><i class="fa">&#xf00c;</i>Check Answers</button></div>',back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Back to Dictionary</button>'},active:{type:null,exercise:null,index:0,path:window.location.pathname.replace(/.*?\/lessons.*?\/(.*?\/.*?)\/.*/g,"$1")},exercises:GenkiExercises,scrollTo:function(el,delay){if(typeof el=="string"){el=document.querySelector(el)}var scroll=function(){document.body.scrollTop=el.offsetTop;document.documentElement.scrollTop=el.offsetTop};if(delay){setTimeout(scroll,100)}else{scroll()}},QuizType:{DRAG:"drag",KANA:"kana",WRITING:"writing",MULTI:"multi",FILL:"fill",STROKE:"stroke",DRAWING:"drawing"},generateQuiz:function(o){if(!Genki.exerciseData&&window.JSON){Genki.exerciseData=JSON.stringify(o)}var zone=document.getElementById("quiz-zone");if(typeof o.type==="object"){var begin=/(?:begin|start)=\d/.test(window.location.search)?window.location.search.replace(/.*?(?:begin|start)=(\d).*/,"$1"):false,i=0,j=o.type.length,opts="",modal;for(;i<j;i++){opts+='<option value="'+i+'"'+(begin!==false?i==begin?" selected":"":storageOK&&localStorage["genki_pref_"+o.format]==o.type[i]?" selected":"")+">"+Genki.lang.opts[o.format][o.type[i]]+"</option>"}modal=GenkiModal.open({title:"Please Select an Exercise Type",content:'Please select the type of exercise you would like to do, then click "Begin" to start studying.<br><br>'+'<div class="center">'+(/\/dictionary\/|\/custom-vocab\//.test(window.location)?"":"<div>"+"<b>Current Exercise</b><br>"+document.title.replace(/ \| Genki Study Resources.*$/,"")+"</div><br>")+"<div>"+"<b>Exercise Type</b><br>"+'<select id="exercise-type">'+opts+"</select>"+"</div><br>"+'<div title="The exercise type can still be changed via the Change Exercise Type button at the bottom of an exercise.">'+'<input id="modal-skip-ex-type" class="genki_input_hidden" type="checkbox"'+(storageOK&&localStorage.genkiSkipExType=="true"?" checked":"")+' onchange="localStorage.genkiSkipExType = this.checked">'+'<span tabindex="0" class="genki_pseudo_checkbox" onclick="this.previousSibling.click();" onkeypress="event.key == \'Enter\' && this.previousSibling.click();"></span>'+'<label class="checkbox-label" for="modal-skip-ex-type">Skip Exercise Type Selection</label>'+"</div>"+"</div>",buttonText:"Begin",noClose:1,zIndex:"low",callback:function(){var type=document.getElementById("exercise-type").value;o.type=o.type[type];o.info=typeof o.info=="object"&&o.info[type]?o.info[type]:o.info;if(storageOK){localStorage["genki_pref_"+o.format]=o.type}if(/vocab|kana|numbers|kanji/.test(o.format)){if(o.format=="kana"&&o.type!="kana"){var kana={},i,k;for(i in o.quizlet){for(k in o.quizlet[i]){kana[k]=o.quizlet[i][k]}}o.quizlet=kana;o.info=o.info.replace("%{KANA}",Genki.active.exercise[1].replace(/.*?(Hiragana|Katakana).*/,"$1"))}if(o.format=="kanji"){if(o.readings){var i;for(i in o.quizlet){var yomikata=o.quizlet[i].split("|");o.quizlet[i]=(yomikata[0]?'<span class="yomikata" title="on-yomi">▶</span>'+yomikata[0]+"<br>":"")+(yomikata[1]?'<span class="yomikata" title="kun-yomi">▷</span>'+yomikata[1]:"")}o.info+=Genki.lang.kanji_yomikata}if(o.type=="drag"){document.getElementById("exercise").className+=o.readings?" kanji-readings":o.meanings?" kanji-meanings":""}}if(o.type=="multi"){var quizlet=[],keys=[],keys2=[],currentAnswer,sentence,answer,answers,def,i,j,k,n,n2;for(i in o.quizlet){keys.push(i);keys2.push(i)}for(i=0,j=keys.length;i<j;i++){n=Math.floor(Math.random()*keys.length);def=keys[n].split("|");currentAnswer=o.quizlet[keys[n]].replace(/\|.*?$/,"");sentence=/\|/.test(o.quizlet[keys[n]])?o.quizlet[keys[n]].replace(/.*?\|(.*?$)/,"$1"):"";quizlet.push({question:'<div class="multi-vocab">'+(def[1]?"<ruby>":o.format=="kanji"?'<div class="big-kanji">':"")+def[0]+(def[1]?"<rt>"+def[1]+"</rt></ruby>":o.format=="kanji"?"</div>":"")+(sentence?'<hr><div class="multi-vocab-sentence">'+sentence+"</div>":"")+"</div>",answers:["A"+currentAnswer]});answers=keys2.slice();answers.splice(n,1);k=3;while(k-- >0){if(answers.length){n2=Math.floor(Math.random()*answers.length);answer=o.quizlet[answers[n2]].replace(/\|.*?$/,"");if(answer==currentAnswer){k++}else{quizlet[i].answers.push(answer.charAt(0)=="A"?"!"+answer:answer)}answers.splice(n2,1)}else{break}}keys.splice(n,1)}o.quizlet=quizlet}else if(o.type=="writing"){var quizlet={},split,i;for(i in o.quizlet){split=i.split("|");for(var a=split[0].split("／"),b=0,c=a.length,furi;b<c;b++){furi=split[1]?split[1]:o.format=="kana"?o.quizlet[i]:"";quizlet[a[b].replace(/\(.*?\)|（.*?）|～/g,"")]=furi;if(/\(.*?\)|（.*?）/.test(a[b])){quizlet[a[b].replace(/～|\(|\)|（|）/g,"")]=furi}}}o.quizlet=quizlet;o.columns=6}else if(o.type=="fill"){if(/vocab|numbers/.test(o.format)){var quizlet='<div class="count-problems columns-2 clear"><div>',keys=[],def,problem,i,j,n;for(i in o.quizlet){keys.push(i)}for(i=0,j=keys.length,n=Math.ceil(j/2);i<j;i++){def=keys[i].split("|");problem=("{"+def[0].replace(/。|～/g,"")+(def[1]?"|"+def[1].replace(/。|～/g,""):"")+(/。|～/g.test(def[0])?"|"+def[0]:"")+(def[1]&&/。|～/g.test(def[1])?"|"+def[1]:"")+"}").replace(/\((.*?)\)/g,"%($1/)").replace(/（(.*?)）/g,"%($1/)").replace(/／/g,"|");quizlet+=(i==n?"</div><div>":"")+'<div class="problem">'+o.quizlet[keys[i]].replace(/\|.*?$/,"")+"<br>"+(/\|/.test(problem)?problem.replace("}","|answer}"):problem)+"</div>"}o.quizlet=quizlet+"</div></div>"}else if(o.format=="kana"){o.quizlet=o.chart}}}else if(o.format=="practice"){o.quizlet=o.quizlet[type];var img=document.querySelector(".multi-quiz-image");if(o.type=="fill"&&img){img.style.display="none"}else if(o.type=="multi"&&img){img.style.display=""}}else if(o.format=="hirakata"){o.quizlet=o.quizlet[type]?o.quizlet[type]:o.quizlet[o.quizlet.length-1]}Genki.generateQuiz(o);Genki.changingExType=false}});if(!Genki.changingExType&&(begin!==false||storageOK&&localStorage.genkiSkipExType=="true")){modal.callback();GenkiModal.close()}Genki.create.exerciseTypeButton();return false}Genki.active.type=o.type;if(o.type=="drag"){var quiz='<div id="quiz-info">'+o.info+'</div><div id="question-list">',dropList='<div id="drop-list">',keysQ=[],keysA,helper,helperPresent,i;for(i in o.quizlet){keysQ.push(i)}keysA=keysQ.slice(0);while(keysQ.length){i=Math.floor(Math.random()*keysQ.length);helper=/\|/.test(keysQ[i])?'data-helper="'+keysQ[i].split("|").pop()+'"':null;quiz+='<div class="quiz-item-group">'+'<div class="quiz-item" '+(helper||"")+">"+(helper?keysQ[i].replace(/(.*?)\|(.*)/,'$1<span class="hidden-text">$2</span>'):keysQ[i])+"</div>"+"</div>";dropList+='<div tabindex="0" class="quiz-answer-zone'+(/\|/.test(keysQ[i])?" helper-answer":"")+'" data-text="'+keysQ[i].replace(/\|.*?$/,"")+'" data-mistakes="0"></div>';keysQ.splice(i,1);++Genki.stats.problems;if(!helperPresent&&helper){helperPresent=true}}quiz+="</div>"+dropList+"</div>";if(helperPresent){zone.className+=" helper-"+(storageOK&&localStorage.furiganaVisible=="false"?"hidden":"present")}quiz+='<div id="answer-list">';while(keysA.length){i=Math.floor(Math.random()*keysA.length);quiz+='<div tabindex="0" class="quiz-item" data-answer="'+keysA[i].replace(/\|.*?$/,"")+'"><div class="quiz-item-text">'+o.quizlet[keysA[i]].replace(/\|.*?$/,"")+"</div></div>";keysA.splice(i,1)}quiz+="</div>";zone.innerHTML=quiz+Genki.lang.review.replace("</div>",Genki.lang.toggle_furigana+'<button id="toggle-orientation" class="button" onclick="Genki.toggle.vocabOrientation(this);"><i class="fa" style="position:relative;transform:rotate(90deg);">&#xf0db;</i>Horizontal Mode</button>'+"</div>");if(storageOK&&localStorage.vocabHorizontal=="true"){Genki.toggle.vocabOrientation(document.getElementById("toggle-orientation"),"false")}}else if(o.type=="kana"){var quiz='<div id="quiz-info">'+o.info+'</div><div id="question-list" class="clear">',answers='<div id="answer-list">',kanaList=[],kana=o.quizlet,i=kana.length-1,k;for(;i>-1;i--){quiz+='<div class="quiz-column">';for(k in kana[i]){quiz+='<div class="quiz-item-row">'+'<div tabindex="0" class="quiz-answer-zone" data-text="'+kana[i][k]+'" data-mistakes="0"></div>'+'<div class="quiz-item">'+kana[i][k]+"</div>"+"</div>";kanaList.push('<div tabindex="0" class="quiz-item" data-answer="'+kana[i][k]+'">'+k+"</div>");++Genki.stats.problems}quiz+="</div>"}while(kanaList.length){i=Math.floor(Math.random()*kanaList.length);answers+=kanaList[i];kanaList.splice(i,1)}zone.innerHTML=quiz+"</div>"+answers+"</div>"+Genki.lang.review}else if(o.type=="writing"){var quiz='<div id="quiz-info">'+o.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+Genki.local+'" target="_blank">clicking here</a>.</div><div id="question-list">',columns=o.columns,width='style="width:'+100/(columns+1)+'%;"',index=0,helper=false,i,j;for(i in o.quizlet){quiz+='<div class="quiz-answer-row'+(o.quizlet[i]?" furi-row":"")+'"><div class="quiz-item" data-helper="'+o.quizlet[i]+'" '+width+'><div class="quiz-item-text">'+i+"</div></div>";j=0;while(columns-- >0){quiz+='<div class="writing-zone" '+width+'><input class="writing-zone-input" type="text" '+(!o.quiz&&j++<3?'placeholder="'+i+'"':"")+' data-answer="'+(o.quiz?o.quizlet[i]:i)+'" data-mistakes="0" tabindex="0" '+(o.quiz?"":'oninput="Genki.check.value(this);"')+' onfocus="Genki.input.index = '+index+++'"></div>';++Genki.stats.problems}quiz+="</div>";columns=o.columns}if(/data-helper/.test(quiz)){helper=true;zone.className+=" helper-"+(storageOK&&localStorage.furiganaVisible=="false"?"hidden":"present")}zone.innerHTML=quiz+"</div>"+Genki.lang.check_answers.replace("</div>",helper?Genki.lang.toggle_furigana+"</div>":"</div>");if(o.quiz){zone.className+=" no-helper"}Genki.input={map:document.querySelectorAll(".writing-zone-input"),index:0};Genki.input.map[0].autofocus=true}else if(o.type=="multi"){var quiz='<div id="quiz-info">'+o.info+'<br><b style="color:#6F6;">NEW:</b> You can now choose between "Instant" and "Classic" Feedback Mode for multiple choice quizzes in the <a href="#genki-site-settings" onclick="GenkiSettings.manager(); return false;">Site Settings</a>.'+'</div><div id="question-list">',answers='<div id="answer-list">',option=65,isAnswer=false,helper=false,vocab=/"format":"vocab"/.test(Genki.exerciseData),q=o.quizlet,i=0,j=q.length,n;for(;i<j;i++){quiz+='<div id="quiz-q'+i+'" class="question-block" data-qid="'+(i+1)+'" style="display:none;"><div class="quiz-multi-question">'+(o.questionsAlignLeft?'<div class="quiz-question-inner-text">':"")+(typeof q[i].question!="undefined"?q[i].question.replace(/\{.*?\}/g,function(match){var data=match.slice(1,match.length-1).split("|");if(data[0]=="!IMG"){return Genki.parse.image(data)}}):'<div class="text-passage'+(q[i].vertical?" vertical-text":"")+'" '+(q[i].text.replace(/<br>/g,"").length<50?'style="text-align:center;"':"")+">"+q[i].text+"</div>"+(q[i].helper||""))+(o.questionsAlignLeft?"</div>":"")+"</div>"+(vocab?'<button class="button vocab-spoiler-toggle" onclick="Genki.toggle.vocabSpoiler(this);"><i class="fa"></i>Show Choices</button><div class="vocab-spoiler">':"");if(q[i].text){quiz+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, true);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, true);">NEXT</div></div>';++Genki.stats.exclude}else{while(q[i].answers.length){n=Math.floor(Math.random()*q[i].answers.length);if(/^A|^\!/.test(q[i].answers[n])){if(q[i].answers[n].charAt(0)=="A"){isAnswer=true}q[i].answers[n]=q[i].answers[n].slice(1)}quiz+='<div class="quiz-multi-row"><div tabindex="0" class="quiz-multi-answer" data-answer="'+isAnswer+'" data-option="'+String.fromCharCode(option++)+'" onclick="Genki.progressQuiz(this);" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this);"><div class="quiz-answer-inner-text">'+q[i].answers[n]+"</div></div></div>";isAnswer=false;q[i].answers.splice(n,1)}}quiz+=(vocab?"</div>":"")+"</div>";option=65;++Genki.stats.problems}if(/class="furigana"|class="inline-furi"|<ruby>/.test(quiz)){helper=true;zone.className+=" helper-"+(storageOK&&localStorage.furiganaVisible=="false"?"hidden":"present")}if(vocab&&storageOK&&localStorage.spoilerMode=="true"){zone.className+=" spoiler-mode"}zone.innerHTML=quiz+"</div>"+'<div id="next-button" class="quiz-multi-row" style="margin-top:-20px; visibility:hidden;'+(Genki.feedbackMode=="classic"?"display:none;":"")+'"><div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.showNextQuestion(this);" onkeypress="event.key == \'Enter\' && Genki.showNextQuestion(this);">NEXT</div></div>'+'<div id="quiz-progress"><div id="quiz-progress-bar"></div></div>'+'<div id="review-exercise" class="center clearfix">'+(Genki.appendix?"":'<button class="button text-selection-mode-button" onclick="Genki.toggle.textSelection(this);"><i class="fa">&#xf246;</i> Enable Text Selection</button>')+(helper?Genki.lang.toggle_furigana:"")+"</div>";Genki.progressQuiz("init")}else if(o.type=="fill"){var helper=false;if(/class="furigana"|class="inline-furi"|<ruby>/.test(o.quizlet)){helper=true;zone.className+=" helper-"+(storageOK&&localStorage.furiganaVisible=="false"?"hidden":"present")}zone.innerHTML='<div id="quiz-info">'+o.info+"<br>If you don't know how to type in Japanese on your computer, please visit our help page by <a href=\"../../../help/writing/"+Genki.local+'" target="_blank">clicking here</a>.</div><div class="text-block">'+o.quizlet.replace(/\{.*?\}/g,function(match){var data=match.slice(1,match.length-1).split("|"),hint,flag,sub,width,placeholder;if(data[0]=="!IMG"){return Genki.parse.image(data)}else if(data[0]=="!AUDIO"){return'<div class="audio-block center">'+'<audio id="'+data[1]+'" controls><source src="'+getPaths()+"resources/audio/"+(Genki.ed=="lessons-3rd"?"3rd-edition/":"2nd-edition/")+data[1]+'.mp3" type="audio/mpeg"></audio>'+"</div>"}else if(data[0]=="!PLAY"){return'<button class="button play-button" onclick="Genki.playAudio(\''+data[1]+"', "+data[2]+');"><i class="fa">&#xf04b;</i></button>'}else{hint=data[1]?data[1]:"",flag=(data[10]||data[9]||data[8]||data[7]||data[6]||data[5]||data[4]||data[3]||data[2]?data[10]||data[9]||data[8]||data[7]||data[6]||data[5]||data[4]||data[3]||data[2]:"").split(";");if(/\%\((.*?)\)/.test(hint)||/\%\((.*?)\)/.test(data[0])){sub=[data[0].match(/%\((.*?)\)/),hint.match(/%\((.*?)\)/)]}++Genki.stats.problems;width=/width:/.test(flag[0])?flag[0].split(":")[1]:flag[1]&&/width:/.test(flag[1])?flag[1].split(":")[1]:flag[2]&&/width:/.test(flag[2])?flag[2].split(":")[1]:sub?(hint?(sub[0]&&sub[0][1]||"/").split("/").concat((sub[1]&&sub[1][1]||"/").split("/")):(sub[0]&&sub[0][1]||"/").split("/")).sort(function(a,b){return b.length-a.length})[0].length*(14/(/[a-z]/i.test(hint||data[0])&&!/[\u3000-\u30FF]/.test(hint||data[0])?2:1))+14+[hint.replace(/\%\((.*?)\)/g,""),data[0].replace(/\%\((.*?)\)/g,"")].sort(function(a,b){return b.length-a.length})[0].length*(14/(/[a-z]/i.test(hint||data[0])&&!/[\u3000-\u30FF]/.test(hint||data[0])?2:1)):[hint,data[0]].sort(function(a,b){return b.length-a.length})[0].length*(14/(/[a-z]/i.test(hint||data[0])&&!/[\u3000-\u30FF]/.test(hint||data[0])?2:1))+14;placeholder=/placeholder:/.test(flag[0])?flag[0].split(":")[1]:flag[1]&&/placeholder:/.test(flag[1])?flag[1].split(":")[1]:flag[2]&&/placeholder:/.test(flag[2])?flag[2].split(":")[1]:null;return'<span class="writing-zone">'+"<input "+'class="writing-zone-input" '+'type="text" '+'data-answer="'+data[0]+'" '+(flag[0]=="answer"?'data-answer2="'+hint+'" ':"")+(flag[0]=="answer"&&data[3]?'data-answer3="'+data[2]+'" ':"")+(flag[0]=="answer"&&data[4]?'data-answer4="'+data[3]+'" ':"")+(flag[0]=="answer"&&data[5]?'data-answer5="'+data[4]+'" ':"")+(flag[0]=="answer"&&data[6]?'data-answer6="'+data[5]+'" ':"")+(flag[0]=="answer"&&data[7]?'data-answer7="'+data[6]+'" ':"")+(flag[0]=="answer"&&data[8]?'data-answer8="'+data[7]+'" ':"")+(flag[0]=="answer"&&data[9]?'data-answer9="'+data[8]+'" ':"")+(flag[0]=="answer"&&data[10]?'data-answer10="'+data[9]+'" ':"")+(flag[0]=="furigana"?'data-furigana="'+hint+'" ':"")+(flag[0]=="placeholder"||placeholder?'placeholder="'+(placeholder||hint)+'" ':"")+'data-mistakes="0" '+'tabindex="0" '+'data-default-width="'+width+'" '+'style="width:'+width*(storageOK&&localStorage.genkiFontSize?+localStorage.genkiFontSize/100:1)+'px;"'+">"+(hint&&!/answer|furigana|placeholder/.test(flag[0])||flag[1]&&/hint:/.test(flag[1])||flag[2]&&/hint:/.test(flag[2])?'<span class="problem-hint">'+(flag[1]&&/hint:/.test(flag[1])?flag[1].split(":")[1]:flag[2]&&/hint:/.test(flag[2])?flag[2].split(":")[1]:hint)+"</span>":"")+"</span>"}})+"</div>"+Genki.lang.check_answers.replace("()","(false, 'fill')").replace("</div>",helper?Genki.lang.toggle_furigana+"</div>":"</div>");document.querySelector(".writing-zone-input").autofocus=true}else if(o.type=="stroke"){var quiz='<div id="quiz-info">'+o.info+'</div><div id="question-list">',answers='<div id="answer-list">',strokeOrderHidden=storageOK&&localStorage.strokeOrderVisible=="false",guideHidden=storageOK&&localStorage.tracingGuideVisible=="false",q=o.quizlet,i=0,j=q.length,img;for(;i<j;i++){if(q[i].kana)q[i].kanji=q[i].kana;if(o.kanaType)o.kanaType=o.kanaType.charAt(0).toUpperCase()+o.kanaType.slice(1).toLowerCase();img=getPaths()+"resources/images/stroke-order/"+q[i].order+".png";quiz+='<div id="quiz-q'+i+'" class="question-block" data-qid="'+(i+1)+'" style="display:none;">'+'<div class="quiz-multi-question">'+'<div class="kanji-container big-kanji'+(q[i].kana?" kana-font":"")+'"'+(q[i].font?' style="font-family:'+q[i].font+'"':"")+">"+q[i].kanji+"</div>"+'<div class="kanji-stroke-order">'+'<a class="button-link" href="'+(q[i].kana?getPaths()+"resources/images/stroke-order/sasagami-"+o.kanaType.toLowerCase()+".jpg":"https://jisho.org/search/"+q[i].kanji+"%20%23kanji")+'" target="_blank" title="View stroke order '+(q[i].kana?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a>'+'<a href="'+img+'" target="_blank" title="Click to view image"><img src="'+img+'" alt="stroke order"/></a>'+"</div>"+"</div>"+'<div class="quiz-multi-row">'+'<canvas class="kanji-canvas" data-kanji="'+q[i].kanji+'" data-strokes="'+q[i].strokes+'" data-guide="'+(guideHidden?false:true)+'"'+(q[i].kana&&!q[i].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':q[i].font?' data-font="'+q[i].font+'"':"")+' id="canvas-'+i+'" width="200" height="200"'+(q[i].kana?'data-kana="true"':"")+"></canvas>"+"</div>"+'<div class="kanji-canvas-actions quiz-multi-row center">'+'<button class="button" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+i+'" title="(CTRL+X)"><i class="fa">&#xf12d;</i>Erase</button>'+'<button class="button" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+i+'" title="(CTRL+Z)"><i class="fa">&#xf0e2;</i>Undo</button>'+(Genki.debug?'<button class="button" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+i+'" title="Open console (F12) to see recognition candidates (CTRL+F)"><i class="fa">&#xf188;</i>Test Recognition</button>':"")+"</div>"+'<div class="quiz-multi-row">'+'<div tabindex="0" class="quiz-multi-answer next-question" onclick="Genki.progressQuiz(this, false, \'stroke\');" onkeypress="event.key == \'Enter\' && Genki.progressQuiz(this, false, \'stroke\');" data-canvas="canvas-'+i+'">Next '+(q[i].kana?o.kanaType:"Kanji")+"</div>"+"</div>"+"</div>";++Genki.stats.problems}zone.innerHTML=quiz+'</div><div id="quiz-progress"><div id="quiz-progress-bar"></div></div>'+'<div id="review-exercise" class="center clearfix">'+'<button id="toggle-stroke-order" class="button" onclick="Genki.toggle.strokeOrder(this);"><i class="fa">&#xf1fc;</i>'+(strokeOrderHidden?"Show":"Hide")+" Stroke Order</button>"+'<button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this);"><i class="fa">&#xf031;</i>'+(guideHidden?"Show":"Hide")+" Tracing Guide</button>"+'<button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button>'+"</div>";if(strokeOrderHidden){zone.className+=" stroke-order-hidden"}Genki.progressQuiz("init",false,"stroke")}else if(o.type=="drawing"){var quiz='<div id="quiz-info">'+o.info+'</div><div id="question-list">',guideHidden=storageOK&&localStorage.tracingGuideVisible=="false",columns=o.columns,width='style="width:'+100/(columns+1)+'%;"',q=o.quizlet,n=0,i=0,j=o.quizlet.length;for(;i<j;i++){if(q[i].kana)q[i].kanji=q[i].kana;quiz+='<div class="quiz-answer-row">'+'<div class="drawing-zone" '+width+">"+'<div class="quiz-item">'+'<div class="quiz-item-text'+(q[i].kana?" kana-font":"")+'"'+(q[i].font?' style="font-family:'+q[i].font+'"':"")+">"+q[i].kanji+"</div>"+"</div>"+'<button class="button stroke-order-button" onclick="Genki.viewStrokeOrder(\''+q[i].kanji+"', '"+q[i].order+"'"+(q[i].kana?",'"+o.kanaType+"'":"")+');">Stroke Order</button>'+"</div>";while(columns-- >0){quiz+='<div class="drawing-zone" '+width+">"+'<canvas class="kanji-canvas" data-kanji="'+q[i].kanji+'" data-guide="'+(o.columns-columns>3?false:guideHidden?false:true)+'"'+(q[i].kana&&!q[i].font?' data-font="NotoSansJP, SawarabiGothic, MS Gothic, Yu Gothic, Meiryo"':q[i].font?' data-font="'+q[i].font+'"':"")+' data-strokes="'+q[i].strokes+'" data-size="100" id="canvas-'+n+'" width="110" height="110"'+(q[i].kana?'data-kana="true"':"")+"></canvas>"+'<div class="kanji-canvas-actions">'+'<button class="button icon-only" onclick="KanjiCanvas.erase(this.dataset.canvas)" data-canvas="canvas-'+n+'" title="Erase (CTRL+X)"><i class="fa">&#xf12d;</i></button>'+'<button class="button icon-only" onclick="KanjiCanvas.deleteLast(this.dataset.canvas)" data-canvas="canvas-'+n+'" title="Undo (CTRL+Z)"><i class="fa">&#xf0e2;</i></button>'+(Genki.debug?'<button class="button icon-only" onclick="console.log(KanjiCanvas.recognize(this.dataset.canvas));" data-canvas="canvas-'+n+'" title="Test Recognition (CTRL+F)"><i class="fa">&#xf188;</i></button>':"")+"</div>"+"</div>";++Genki.stats.problems;++n}quiz+="</div>";columns=o.columns}zone.innerHTML=quiz+"</div>"+Genki.lang.check_answers.replace("()","(false, 'drawing')").replace("</div>",'<button id="toggle-tracing-guide" class="button" onclick="Genki.toggle.tracingGuide(this, true);"><i class="fa">&#xf031;</i>'+(guideHidden?"Show":"Hide")+" Tracing Guide</button>"+'<button id="toggle-stroke-numbers" class="button" onclick="Genki.toggle.strokeNumbers(this);" style="display:none;"><i class="fa">&#xf162;</i>Show Stroke Numbers</button>'+"</div>");for(var c=document.querySelectorAll(".kanji-canvas"),i=0,j=c.length;i<j;i++){KanjiCanvas.init(c[i].id)}}if(Genki.currentAnswers){if(o.type==Genki.currentAnswers.type){for(var a=document.querySelectorAll(".writing-zone-input"),i=0,j=a.length;i<j;i++){a[i].value=Genki.currentAnswers.list[i]}}delete Genki.currentAnswers}if(o.type=="drag"||o.type=="kana"){var drake=dragula([document.querySelector("#answer-list")],{isContainer:function(el){return el.classList.contains("quiz-answer-zone")}});drake.on("drag",function(el){if(Genki.isTouch&&Genki.isTouching&&document.body.style.overflow!="hidden"){document.body.style.overflow="hidden"}if(Genki.markedItem){Genki.markedItem.className=Genki.markedItem.className.replace(" markedItem","");Genki.markedItem=null}Genki.markedItem=el;el.className+=" markedItem"});if(Genki.isTouch){drake.on("cancel",function(){document.body.style.overflow=""})}drake.on("drop",function(el,target,source){if(Genki.isTouch)document.body.style.overflow="";if(target.dataset.text){if(el.dataset.answer!=target.dataset.text){document.getElementById("answer-list").appendChild(el);target.dataset.mistakes=++target.dataset.mistakes;target.dataset.mistakes>1?Genki.stats.mistakes:++Genki.stats.mistakes}else{target.className+=" answer-correct";if(Genki.markedItem){Genki.markedItem.className="quiz-item";Genki.markedItem=null}if(++Genki.stats.solved==Genki.stats.problems){Genki.endQuiz()}}}});Genki.drake=drake;if(!Genki.globalEventListenersSet){Genki.globalEventListenersSet=true;["click","keypress"].forEach(function(eventName){document.addEventListener(eventName,function(e){if(e.type=="keypress"&&e.key!="Enter"||Genki.quizOver){return}var target=e.target,n=4,m=n-1;while(n-- >0){if(n<m)target=target.parentNode?target.parentNode:target;if(/quiz-item$|quiz-answer-zone/.test(target.className))break}if(/quiz-item/.test(target.className)&&target.parentNode.id=="answer-list"){if(Genki.markedItem){Genki.markedItem.className=Genki.markedItem.className.replace(" markedItem","")}Genki.markedItem=target;Genki.markedItem.className+=" markedItem"}else if(Genki.markedItem&&/quiz-answer-zone/.test(target.className)){if(Genki.markedItem.dataset.answer!=target.dataset.text){if(Genki.wrongTimeout){document.getElementById("wrongAnswer").id="";clearTimeout(Genki.wrongTimeout);delete Genki.wrongTimeout}target.id="wrongAnswer";Genki.wrongTimeout=setTimeout(function(){document.getElementById("wrongAnswer").id="";delete Genki.wrongTimeout},1e3);target.dataset.mistakes=++target.dataset.mistakes;++Genki.stats.mistakes}else{target.className+=" answer-correct";target.appendChild(Genki.markedItem);target.tabIndex=-1;target.firstChild.tabIndex=-1;Genki.markedItem.className=Genki.markedItem.className.replace(" markedItem","");Genki.markedItem=null;if(++Genki.stats.solved==Genki.stats.problems){Genki.endQuiz()}}}else if(Genki.markedItem){Genki.markedItem.className=Genki.markedItem.className.replace(" markedItem","");Genki.markedItem=null}if(e.type=="click"&&/quiz-answer-zone/.test(e.target.className)){e.target.blur()}})})}}var timer=new Timer,clock=document.getElementById("quiz-timer");clock.innerHTML="00:00:00";timer.start();timer.addEventListener("secondsUpdated",function(e){clock.innerHTML=timer.getTimeValues().toString()});Genki.timer=timer;if(storageOK&&localStorage.timerAutoPause!="false"){document.addEventListener("visibilitychange",Genki.startOrPauseTimerByVisibility)}document.getElementById("exercise").className+=" content-loaded "+(o.type=="stroke"?"stroke-quiz multi":o.type)+"-quiz";Genki.scrollTo("#exercise-title",true);if(Genki.debug||!/drag|kana|drawing/.test(o.type)&&!Genki.appendix){if(Genki.debug||o.format&&!/vocab|kana|numbers/.test(o.format)||!o.format){Genki.quickJisho.create()}}if(o.type=="fill"||o.type=="writing"){var autofocus=document.querySelector("[autofocus]");if(autofocus&&autofocus!=document.activeElement){autofocus.focus();Genki.debug&&console.warn("autofocus failed: HTMLElement.focus() will be used as a fallback.")}}if(o.type=="multi"){var q=document.querySelector(document.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");if(q)q.focus()}for(var a=document.querySelectorAll("AUDIO"),i=0,j=a.length;i<j;i++){a[i].onplay=function(){for(var a=document.querySelectorAll("AUDIO"),i=0,j=a.length;i<j;i++){if(a[i]!=this&&!a[i].paused){a[i].pause()}}};if(Genki.debug){a[i].ontimeupdate=function(){console.log(this.id,this.currentTime)}}}},incrementProgressBar:function(){var bar=document.getElementById("quiz-progress-bar"),progress=Math.floor((Genki.stats.solved+1)/Genki.stats.problems*100);bar.style.width=progress+"%";bar.innerHTML='<span id="quiz-progress-text">'+(Genki.stats.solved+1)+"/"+Genki.stats.problems+"</span>"},progressQuiz:function(answer,exclude,flag){if(Genki.textSelectMode||Genki.quizOver){return false}if(answer=="init"){document.getElementById("quiz-q"+Genki.stats.solved).style.display="";Genki.incrementProgressBar()}else{if(answer&&flag=="stroke"){var kanji=KanjiCanvas.recognize(answer.dataset.canvas),index;answer=answer.parentNode.parentNode.querySelector(".kanji-canvas");Genki.debug&&console.log("toDraw: "+answer.dataset.kanji);Genki.debug&&console.log("Results: "+kanji);Genki.debug&&console.log("Correct: "+(new RegExp(answer.dataset.kanji).test(kanji)&&answer.dataset.strokesAnswer==answer.dataset.strokes).toString());answer.dataset.answer=new RegExp(answer.dataset.kanji).test(kanji)&&answer.dataset.strokesAnswer==answer.dataset.strokes}answer.className+=" selected-answer";if(exclude){answer.parentNode.className+=" hidden-answer"}if(answer.dataset.answer=="false"){answer.parentNode.parentNode.className+=" wrong-answer";++Genki.stats.mistakes}var last=document.getElementById("quiz-q"+Genki.stats.solved++),next=document.getElementById("quiz-q"+Genki.stats.solved);if(next){if(Genki.feedbackMode=="instant"&&Genki.active.type=="multi"){if(!Genki.multiNodes){Genki.multiNodes={list:document.getElementById("question-list"),button:document.getElementById("next-button"),next:null,last:null}}Genki.quizOver=true;Genki.multiNodes.list.className+=" multi-quiz quiz-over";Genki.multiNodes.button.style.visibility="visible";Genki.multiNodes.button.firstChild.focus();Genki.multiNodes.next=next;Genki.multiNodes.last=last}else{next.style.display="";last.style.display="none";var q=next.querySelector(document.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");if(q)q.focus();Genki.incrementProgressBar()}}else{Genki.endQuiz(flag==Genki.QuizType.STROKE?flag:Genki.QuizType.MULTI);for(var q=document.querySelectorAll('[id^="quiz-q"]'),i=0,j=q.length;i<j;i++){q[i].style.display=""}document.getElementById("quiz-progress").style.display="none"}}if(flag=="stroke"&&document.getElementById("canvas-"+Genki.stats.solved)){KanjiCanvas.init("canvas-"+Genki.stats.solved)}},showNextQuestion:function(caller){Genki.multiNodes.next.style.display="";Genki.multiNodes.last.style.display="none";Genki.quizOver=false;Genki.multiNodes.list.className=Genki.multiNodes.list.className.replace(" multi-quiz quiz-over","");Genki.multiNodes.button.style.visibility="hidden";var q=Genki.multiNodes.next.querySelector(document.querySelector(".spoiler-mode")?".vocab-spoiler-toggle":".quiz-multi-answer");if(q)q.focus();Genki.incrementProgressBar()},endQuiz:function(type){Genki.quizOver=true;type=type=="drawing"?"stroke":type;var solved=Genki.stats.solved-Genki.stats.exclude,problems=Genki.stats.problems-Genki.stats.exclude;Genki.stats.score=Math.floor((solved-Genki.stats.mistakes)*100/problems);Genki.timer.stop();var timer=document.getElementById("quiz-timer");timer.style.display="none";document.getElementById("quiz-result").innerHTML='<div id="complete-banner" class="center">Quiz Complete!</div>'+'<div id="result-list">'+'<div class="result-row"><span class="result-label">Problems Solved:</span>'+problems+"</div>"+'<div class="result-row"><span class="result-label">Answers Wrong:</span>'+Genki.stats.mistakes+"</div>"+'<div class="result-row"><span class="result-label">Score:</span>'+Genki.stats.score+"%</div>"+'<div class="result-row"><span class="result-label">Completion Time:</span>'+timer.innerHTML+"</div>"+'<div class="result-row center">'+(Genki.stats.score==100?"PERFECT! Great Job, you have mastered this quiz! Feel free to move on or challenge yourself by trying to beat your completion time.":Genki.stats.score>70?"Nice work! "+Genki.lang[type?type+"_mistakes":"mistakes"]:"Keep studying! "+Genki.lang[type?type+"_mistakes":"mistakes"])+(document.querySelector(".alt-phrase")?"<br><br>"+Genki.lang.sub_answers:"")+'<div class="center">'+(/\/dictionary\//.test(window.location)?Genki.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Try Again</button>')+'<button class="button" onclick="Genki.breakTime();"><i class="fa">&#xf0f4;</i>Take a Break</button>'+'<a href="'+document.getElementById("home-link").href+'" class="button"><i class="fa">&#xf015;</i>Back to Index</a>'+"</div>"+"</div>"+"</div>";if(Genki.active.exercise.length>0&&!/appendix|study-tools/.test(Genki.active.exercise[0])){var lesson=Genki.active.exercise[0],genkiEdition=localStorage.GenkiEdition,lessonsResults=JSON.parse(localStorage.Results);if(!lessonsResults[genkiEdition])lessonsResults[genkiEdition]={};var editionLessonsResults=lessonsResults[genkiEdition];editionLessonsResults[lesson]=typeof editionLessonsResults[lesson]=="undefined"||Genki.stats.score>editionLessonsResults[lesson]?Genki.stats.score:editionLessonsResults[lesson];localStorage.Results=JSON.stringify(lessonsResults);Genki.create.removeExerciseList();Genki.create.exerciseList()}if(type=="stroke"){document.getElementById("toggle-stroke-numbers").style.display="";document.getElementById("toggle-tracing-guide").style.display="none"}if(Genki.drake){setTimeout(function(){Genki.drake.destroy();delete Genki.drake},100)}var changeType=document.getElementById("change-exercise-type-container");if(changeType)changeType.style.display="none";document.getElementById("exercise").className+=" quiz-over";Genki.scrollTo("#complete-banner",true)},reset:function(skipModal){if(window.JSON){if(!skipModal&&/fill-quiz|writing-quiz/.test(document.getElementById("exercise").className)&&Genki.stats.mistakes>0){return GenkiModal.open({title:"Try again with your current answers?",content:"<div>Would you like to try again with your current answers? This will allow you to correct the answers you got wrong while preserving what you have already written.</div><br>"+"<div>※ Please note that your answers will be lost if you change the page or exercise type.</div>",buttonText:"Yes",closeButtonText:"No",customButton:'<button id="genki-modal-cancel" class="button" onclick="GenkiModal.close();">Cancel</button>',keepOpen:true,callback:function(){for(var currentAnswers=[],a=document.querySelectorAll(".writing-zone-input"),i=0,j=a.length;i<j;i++){currentAnswers.push(a[i].value)}Genki.currentAnswers={type:/fill-quiz/.test(document.getElementById("exercise").className)?"fill":"writing",list:currentAnswers};GenkiModal.close();Genki.reset(true)},closeCallback:function(){GenkiModal.close();Genki.reset(true)}})}Genki.exerciseComplete=false;Genki.quizOver=false;Genki.isTouching=false;Genki.textSelectMode=false;Genki.strokeNumberDisplay=false;Genki.markedItem=null;Genki.stats={problems:0,solved:0,mistakes:0,score:0,exclude:0};if(Genki.multiNodes){delete Genki.multiNodes}Genki.timer.isRunning()&&Genki.timer.stop();if(Genki.quickJisho.cache){!Genki.quickJisho.hidden&&Genki.quickJisho.toggle();Genki.quickJisho.search("");Genki.quickJisho.cache.search.value=""}var exercise=document.getElementById("exercise"),img=document.querySelector(".multi-quiz-image");exercise.className="content-block";exercise.innerHTML=document.getElementById("exercise-title").outerHTML+'<div id="quiz-result"></div><div id="quiz-zone" class="clear"></div>'+(img?img.outerHTML:"")+'<div id="quiz-timer" class="center"></div>'+document.querySelector(".more-exercises").outerHTML;if(Genki.appendix){exercise.style.display="none";document.getElementById("appendix-tool").style.display="";Genki.scrollTo(/\/dictionary\//.test(window.location)?"#practice-words":".title");if(/\/dictionary\//.test(window.location))Genki.appendix.jisho.launchExercise();else if(/\/map-of-japan\//.test(window.location))Genki.appendix.studyMap();else if(/\/numbers-chart\//.test(window.location))Genki.appendix.studyChart("numbers");else if(/\/conjugation-chart\//.test(window.location))Genki.appendix.studyChart("conjugation")}else if(Genki.tools){exercise.style.display="none";document.getElementById("study-tool-editor").style.display="";Genki.scrollTo(".title")}else{Genki.generateQuiz(JSON.parse(Genki.exerciseData))}}else{window.location.reload()}},breakTime:function(){GenkiModal.open({title:"Take a Break?",content:"Taking a break and waiting before trying again can greatly help with building your memory. 5 to 10 minute breaks are recommended, but you're free to adjust the time to your liking."+(/"format":"vocab"|"type":"drag"/.test(Genki.exerciseData)?' Please see <a href="'+getPaths()+"help/vocab-memorization/"+Genki.local+'" target="_blank">this page</a> for more tips on memorizing vocab.':"")+"<br><br>"+'<div class="center">Wait <input id="break-minutes" class="center" type="number" value="'+Genki.breakTimer[Genki.breakMultiplier]+'" min="1" max="60" onchange="Genki.changeBreakMultiplier(this);"> Minute(s)</div>',buttonText:"Wait",keepOpen:true,callback:function(){if(Genki.breakMultiplier<Genki.breakTimer.length-1){if(Genki.breakMultiplier==2&&!Genki.breakTimerCustom){var f=document.getElementById("toggle-furigana");if(f&&/helper-present/.test(document.getElementById("quiz-zone").className)==true){f.click()}}Genki.breakMultiplier++}if(!Genki.local&&Genki.canNotify&&!/denied|granted/.test(Notification.permission)){Notification.requestPermission()}var time=+document.getElementById("break-minutes").value,n;if(time>60){time=60}else if(time<=0){time=1}GenkiModal.open({title:"Taking a Break",content:'<div id="break-timer" class="center">00:'+(time<10?"0":"")+time+":00</div>",buttonText:"End Break Time",keepOpen:Genki.appendix||!Genki.tools&&/"format"/.test(Genki.exerciseData)?true:false,callback:function(){Genki.reset();document.body.className=document.body.className.replace(" taking-a-break","")}});document.body.className+=" taking-a-break";n=Math.floor(Math.random()*10)+1;document.getElementById("genki-modal-overlay").style.backgroundImage="url(../../../resources/images/backgrounds/bg-"+(n<10?"0":"")+n+".jpg)";var timer=new Timer,clock=document.getElementById("break-timer");timer.start({startValues:{minutes:time},target:{seconds:0},countdown:true});timer.addEventListener("secondsUpdated",function(e){var timeString=timer.getTimeValues().toString();clock.innerHTML=timeString;if(timeString=="00:00:00"){clock.innerHTML='Break time is up!<div style="font-size:15px;">Click the button below to resume your studies.</div>';document.getElementById("genki-modal-ok").style.display="inline-block";if(!Genki.local&&Genki.canNotify&&Notification.permission=="granted"){var notif=new Notification(document.title.replace(/ \| Genki Study Resources.*$/,""),{body:"Break time is up!",icon:document.querySelector('meta[property="og:image"]').content,tag:"breakTime-"+Genki.active.index});notif.onclick=function(){window.focus();this.close()}}}})}})},breakMultiplier:0,breakTimer:[5,10,15,20,30,40,50,60],breakTimerCustom:false,changeBreakMultiplier:function(caller){var n=Number(caller.value);if(n<=5){Genki.breakMultiplier=0}else if(n<=10){Genki.breakMultiplier=1}else if(n<=15){Genki.breakMultiplier=2}else if(n<=20){Genki.breakMultiplier=3}else if(n<=30){Genki.breakMultiplier=4}else if(n<=40){Genki.breakMultiplier=5}else if(n<=50){Genki.breakMultiplier=6}else if(n<=60){Genki.breakMultiplier=7}Genki.breakTimerCustom=true},review:function(){GenkiModal.open({title:"Activate Review Mode?",content:"Are you sure you want to review? Your current progress will be lost.",callback:function(){var a=document.querySelectorAll("[data-answer]"),i=0,j=a.length;for(;i<j;i++){document.querySelector('[data-text="'+a[i].dataset.answer+'"]').appendChild(a[i])}Genki.timer.stop();Genki.drake.destroy();document.getElementById("quiz-timer").style.display="none";document.getElementById("review-exercise").innerHTML=(/\/dictionary\//.test(window.location)?Genki.lang.back_to_dict:'<button class="button" onclick="Genki.reset();"><i class="fa">&#xf021;</i>Restart</button>')+(document.querySelector(".drag-quiz")?Genki.lang.toggle_furigana+document.getElementById("toggle-orientation").outerHTML:"");document.getElementById("quiz-info").innerHTML='You are currently in review mode; go ahead and take your time to study. When you are ready to practice this exercise, click the "restart" button.';document.getElementById("quiz-zone").className+=" review-mode";var changeType=document.getElementById("change-exercise-type-container");if(changeType)changeType.style.display="none"}})},toHalfWidth:function(str){return str.replace(/[\uFF01-\uFF5E]/g,function(c){return String.fromCharCode(c.charCodeAt(0)-65248)})},check:{busy:false,value:function(input){if(!Genki.check.busy&&input.value==input.dataset.answer){Genki.check.busy=true;var next=Genki.input.map[Genki.input.index+1];if(next){next.focus()}else{window.setTimeout(function(){input.blur();Genki.check.answers(true);Genki.check.busy=false},10)}}else if(Genki.check.busy){window.setTimeout(function(){Genki.check.busy=false;if(document.activeElement&&document.activeElement.value&&document.activeElement.value==Genki.input.map[Genki.input.index-1].value){document.activeElement.value=""}},10)}},answers:function(mapEnded,type){!Genki.exerciseComplete&&GenkiModal.open({title:"Check Answers?",content:mapEnded?"The last input field has been filled in. Are you ready to check your answers?":"Checking your answers will end the quiz. Do you want to continue?",buttonText:"Yes, check my answers!",callback:function(){Genki.exerciseComplete=true;document.querySelector("#check-answers button").style.display="none";if(type&&type=="drawing"){var answer=document.querySelectorAll(".kanji-canvas"),i=0,j=answer.length,kanji;for(;i<j;i++){kanji=KanjiCanvas.recognize(answer[i].id);Genki.debug&&console.log("toDraw: "+answer[i].dataset.kanji);Genki.debug&&console.log("Results: "+kanji);Genki.debug&&console.log("Correct: "+(new RegExp(answer[i].dataset.kanji).test(kanji)&&answer[i].dataset.strokesAnswer==answer[i].dataset.strokes).toString());if(new RegExp(answer[i].dataset.kanji).test(kanji)&&answer[i].dataset.strokesAnswer==answer[i].dataset.strokes){answer[i].dataset.answer=true}else{answer[i].dataset.answer=false;++Genki.stats.mistakes}++Genki.stats.solved}}else{var input=document.querySelectorAll("#exercise .writing-zone-input"),i=0,j=input.length,k,correct,val,data,answer,alt;for(;i<j;i++){correct=false;data=input[i].dataset;val=Genki.toHalfWidth(input[i].value).toLowerCase().replace(/。|、/g,"");for(k in data){if(/answer/.test(k)){answer=Genki.toHalfWidth(data[k]).toLowerCase().replace(/。|、/g,"");if(/%\(.*?\)/.test(answer)){alt=answer.replace(/.*?%\((.*?)\).*/,"$1").split("/");if(k=="answer"||k=="answer2"){while(alt.length){if(val==answer.replace(/%\(.*?\)/,alt[0])){correct=true;break}alt.splice(0,1)}}else if((k=="answer3"||k=="answer4"||k=="answer5"||k=="answer6"||k=="answer7"||k=="answer8"||k=="answer9"||k=="answer10")&&alt.indexOf(val)!=-1){correct=true}}else if(val==answer){correct=true}if(correct)break}}if(correct){input[i].parentNode.className+=" answer-correct"}else{++data.mistakes;++Genki.stats.mistakes;if(type=="fill"){input[i].parentNode.insertAdjacentHTML("beforeend",('<span class="problem-answer">'+data.answer+(data.answer2||data.furigana?'<span class="secondary-answer'+(data.furigana?" furigana-only":"")+'">'+(data.answer2||data.furigana)+"</span>":"")+"</span>").replace(/%\((.*?)\)/g,function(Match,$1){return'<span class="alt-phrase">(</span>'+$1.replace(/\//g,'<span class="alt-phrase-sep">/</span>')+'<span class="alt-phrase">)</span>'}))}}++Genki.stats.solved;input[i].disabled=true}}Genki.endQuiz(type?type:Genki.QuizType.WRITING)}})}},toggle:{exerciseList:function(button){button.className=button.className=="list-open"?"":"list-open"},list:function(el){var closed="lesson-title",opened=closed+" lesson-open";el.className=el.className==opened?closed:opened;for(var a=el.parentNode.querySelectorAll(".lesson-title"),i=0,j=a.length;i<j;i++){if(a[i]!=el){a[i].className=closed}}},furigana:function(button){var zone=document.getElementById("quiz-zone"),state=storageOK&&localStorage.furiganaVisible||(/helper-hidden/.test(zone.className)?"false":"true");switch(state){case"true":state="false";zone.className=zone.className.replace("helper-present","helper-hidden");button.innerHTML=button.innerHTML.replace("Hide","Show");break;case"false":state="true";zone.className=zone.className.replace("helper-hidden","helper-present");button.innerHTML=button.innerHTML.replace("Show","Hide");break;default:break}Genki.lang.toggle_furigana=button.outerHTML;if(storageOK){localStorage.furiganaVisible=state}},vocabSpoiler:function(button){var spoiler=button.nextSibling;if(/spoiler-off/.test(spoiler.className)){spoiler.className=spoiler.className.replace("spoiler-off","");button.innerHTML=button.innerHTML.replace("Hide","Show")}else{spoiler.className+=" spoiler-off";button.innerHTML=button.innerHTML.replace("Show","Hide")}},vocabOrientation:function(button,customState){var zone=document.getElementById("quiz-zone"),state=typeof customState!=="undefined"?customState:storageOK&&localStorage.vocabHorizontal||(/vocab-horizontal/.test(zone.className)?"true":"false"),answer=document.querySelectorAll(".quiz-answer-zone"),i=0,j=answer.length;switch(state){case"true":state="false";zone.className=zone.className.replace(" vocab-horizontal","");button.innerHTML=button.innerHTML.replace("Vertical","Horizontal");button.querySelector("i").style.transform="rotate(90deg)";for(var dropList=document.getElementById("drop-list");i<j;i++){dropList.appendChild(answer[i])}break;case"false":state="true";zone.className+=" vocab-horizontal";button.innerHTML=button.innerHTML.replace("Horizontal","Vertical");button.querySelector("i").style.transform="rotate(0deg)";for(var group=document.querySelectorAll(".quiz-item-group");i<j;i++){group[i].appendChild(answer[i])}break;default:break}if(storageOK&&!customState){localStorage.vocabHorizontal=state}},strokeNumbers:function(button){var zone=document.getElementById("quiz-zone");switch(Genki.strokeNumberDisplay){case true:Genki.strokeNumberDisplay=false;button.innerHTML=button.innerHTML.replace("Hide","Show");break;case false:Genki.strokeNumberDisplay=true;button.innerHTML=button.innerHTML.replace("Show","Hide");break;default:break}for(var a=document.querySelectorAll(".kanji-canvas"),i=0,j=a.length;i<j;i++){if(KanjiCanvas["canvas_"+a[i].id])KanjiCanvas.redraw(a[i].id,false,Genki.strokeNumberDisplay)}},strokeOrder:function(button){var zone=document.getElementById("quiz-zone"),state=storageOK&&localStorage.strokeOrderVisible||(/stroke-order-hidden/.test(zone.className)?"false":"true");switch(state){case"true":state="false";zone.className=zone.className+=" stroke-order-hidden";button.innerHTML=button.innerHTML.replace("Hide","Show");break;case"false":state="true";zone.className=zone.className.replace(" stroke-order-hidden","");button.innerHTML=button.innerHTML.replace("Show","Hide");break;default:break}if(storageOK){localStorage.strokeOrderVisible=state}},tracingGuide:function(button,drawingPractice){var zone=document.getElementById("quiz-zone"),state=storageOK&&localStorage.tracingGuideVisible?localStorage.tracingGuideVisible:"true";switch(state){case"true":state="false";button.innerHTML=button.innerHTML.replace("Hide","Show");break;case"false":state="true";button.innerHTML=button.innerHTML.replace("Show","Hide");break;default:break}var a=document.querySelectorAll(".kanji-canvas"),i=0,j=a.length;if(!drawingPractice){for(;i<j;i++){a[i].dataset.guide=state;if(KanjiCanvas["canvas_"+a[i].id])KanjiCanvas.redraw(a[i].id,true)}}else{for(var n=0,kanji="";i<j;i++){if(a[i].dataset.kanji!=kanji){kanji=a[i].dataset.kanji;n=0}if(n++<3){a[i].dataset.guide=state;if(KanjiCanvas["canvas_"+a[i].id])KanjiCanvas.redraw(a[i].id,true)}}}if(storageOK){localStorage.tracingGuideVisible=state}},textSelection:function(button){var zone=document.getElementById("quiz-zone");switch(Genki.textSelectMode){case true:Genki.textSelectMode=false;zone.className=zone.className.replace(" text-selection-mode","");button.innerHTML=button.innerHTML.replace("Dis","En");break;case false:Genki.textSelectMode=true;zone.className=zone.className+=" text-selection-mode";button.innerHTML=button.innerHTML.replace("En","Dis");break;default:break}}},create:{exerciseButtons:function(){var more='<div class="more-exercises clear">',i=2,a;while(i-- >0){a=Genki.exercises[i==1?Genki.active.index-1:Genki.active.index+1];if(a&&!/^\.\.\//.test(a)){a=a.split("|");more+='<a href="../../../'+Genki.ed+"/"+a[0]+"/"+Genki.local+Genki.debug+'" class="button '+(i==1?"prev":"next")+'-ex" title="'+(i==1?"Previous":"Next")+' exercise">'+a[1]+"</a>"}}document.getElementById("quiz-timer").insertAdjacentHTML("afterend",more+"</div>")},removeExerciseList:function(){var list=document.getElementById("exercise-list"),toggle=document.getElementById("toggle-exercises");if(list)list.parentNode.removeChild(list);if(toggle)toggle.parentNode.removeChild(toggle)},exerciseList:function(){var attrs='class="lesson-title" onclick="Genki.toggle.list(this);" onkeydown="event.key == \'Enter\' && Genki.toggle.list(this);" tabindex="0"',list='<nav id="exercise-list">'+'<h3 class="main-title">Exercise List</h3>'+'<button id="random-exercise" class="button" onclick="Genki.randomExercise();" title="Random Exercise"><i class="fa">&#xf074;</i></button>'+'<div id="lessons-list"><h4 '+attrs+'>Page links</h4><ul id="page-links">',lesson="\\.\\.\\/",i=0,j=Genki.exercises.length,linkData,active,currentGroup,group="",groups=/workbook-\d+|literacy-\d+|literacy-wb-\d+/,groupTitles={workbook:"Workbook",literacy:"Reading and Writing","literacy-wb":"Workbook: Reading and Writing"};if(storageOK){localStorage.GenkiEdition=/lessons-3rd/.test(window.location.pathname)?"3rd":"2nd";if(!localStorage.Results){var results={};results[localStorage.GenkiEdition]={};localStorage.Results=JSON.stringify(results)}}for(;i<j;i++){linkData=Genki.exercises[i].split("|");currentGroup=linkData[0].replace(/^lesson-\d+\/|-\d+$/g,"");if(!new RegExp(lesson).test(linkData[0])){lesson=/^appendix/.test(linkData[0])?"appendix":/^study-tools/.test(linkData[0])?"study-tools":linkData[0].replace(/(lesson-\d+)\/.*/,"$1");list+="</ul><h4 "+attrs+">"+lesson.charAt(0).toUpperCase()+lesson.replace(/-/," ").slice(1)+'</h4><ul id="'+lesson+'">';group=""}if(groups.test(linkData[0])&&group!=currentGroup){group=currentGroup;list+='<li><h4 class="sub-lesson-title">'+groupTitles[group]+"</h4></li>"}var resultsStorage=JSON.parse(localStorage.Results),editionResultStorage=resultsStorage[localStorage.GenkiEdition],lessonResult=editionResultStorage?parseInt(editionResultStorage[linkData[0]]):null,resultSpans={perfect:'<span class="exercise-results result--perfect" title="Exercise score"><i class="fa">&#xf005;</i> ',good:'<span class="exercise-results result--good" title="Exercise score"><i class="fa">&#xf00c;</i> ',average:'<span class="exercise-results result--average" title="Exercise score"><i class="fa">&#xf10c;</i> ',low:'<span class="exercise-results result--low" title="Exercise score"><i class="fa">&#xf00d;</i> '},resultSpan=lessonResult==100?resultSpans.perfect:lessonResult>=70?resultSpans.good:lessonResult>=50?resultSpans.average:resultSpans.low,prevScore=lessonResult>-1?resultSpan+lessonResult+"%"+"</span>":"";list+='<li class="menu-item-list"><a href="'+(lesson=="\\.\\.\\/"?linkData[0]:"../../../"+Genki.ed+"/"+linkData[0]+"/")+Genki.local+Genki.debug+'" '+(linkData[2]?'data-page="Genki '+(+linkData[0].replace(/lesson-(\d+).*/,"$1")<13?"I":"II")+(/workbook-|wb-/.test(linkData[0])?" Workbook":"")+": "+linkData[2]+'"':"")+' title="'+linkData[1]+'">'+linkData[1]+"</a>"+" "+prevScore+"</li>"}document.getElementById("content").insertAdjacentHTML("afterbegin",'<a href="#toggle-exercises" id="toggle-exercises" onclick="Genki.toggle.exerciseList(this); return false;" title="Toggle exercise list"></a>'+list+"</ul></div></nav>");if(Genki.active.exercise){Genki.toggle.list(document.getElementById(/^appendix/.test(Genki.active.exercise[0])?"appendix":/^study-tools/.test(Genki.active.exercise[0])?"study-tools":Genki.active.exercise[0].replace(/(lesson-\d+)\/.*/,"$1")).previousSibling);active=document.querySelector('a[href*="'+Genki.active.exercise[0]+'"]');active.className+=" active-lesson";active=active.parentNode;document.getElementById("lessons-list").scrollTop=active.offsetTop-(active.getBoundingClientRect().height+(window.matchMedia&&matchMedia("(pointer:coarse)").matches?0:6))}},exerciseTypeButton:function(){var timer=document.getElementById("quiz-timer"),div=document.createElement("DIV"),button=document.createElement("BUTTON");div.id="change-exercise-type-container";div.className="center";button.id="change-exercise-type";button.className="button";button.innerHTML='<i class="fa">&#xf021;</i> Change Exercise Type';button.onclick=function(){GenkiModal.open({title:"Change Exercise Type?",content:"To change the exercise type, you must quit the current exercise. Do you want to quit?",buttonText:"Quit",closeButtonText:"Cancel",keepOpen:/\/dictionary\//.test(window.location)||!Genki.tools&&/"format"/.test(Genki.exerciseData)?true:false,callback:function(){if(/(?:begin|start)=\d/.test(window.location.search)){if(window.history&&window.history.pushState){window.history.pushState({},document.title,window.location.href.replace(window.location.search,"")+Genki.debug)}else{window.location.search="";return}}Genki.changingExType=true;Genki.reset()}})};div.appendChild(button);if(timer.nextSibling){timer.parentNode.insertBefore(div,timer.nextSibling)}else{timer.parentNode.appendChild(div)}}},parse:{image:function(data){var url=/^http/.test(data[1])?data[1]:"../../../resources/images/lesson-images/"+data[1];return'<a href="'+url+'" target="blank" title="View full image" class="lesson-image"><img src="'+url+'" alt="'+(data[2]||data[1])+'" /></a>'}},quickJisho:{hidden:true,selectorHidden:true,tabbing:false,create:function(){if(Genki.quickJisho.cache)return;var button=document.createElement("DIV"),box=document.createElement("DIV"),selector=document.createElement("BUTTON"),frag=document.createDocumentFragment();button.id="quick-jisho-toggle";button.innerHTML='<i class="fa">&#xf02d;</i>';button.title="Toggle Quick Dictionary";button.tabIndex=0;button.onclick=Genki.quickJisho.toggle;button.onkeypress=function(e){e.key=="Enter"&&Genki.quickJisho.toggle()};box.id="quick-jisho-window";box.className="quick-jisho-hidden";box.innerHTML='<h3 id="quick-jisho-title" class="main-title">Quick Dictionary <span id="quick-jisho-hits"></span></h3>'+'<div id="quick-jisho-content">'+'<div class="quick-jisho-row center">'+'<input tabindex="0" id="quick-jisho-search" type="text" placeholder="Search..." oninput="Genki.quickJisho.search(this.value);">'+"</div>"+'<div class="quick-jisho-row">'+'<ul id="quick-jisho-results"></ul>'+"</div>"+"</div>";selector.id="quick-jisho-selector";selector.className="button";selector.style.display="none";selector.innerHTML='<i class="fa">&#xf002;</i>Look up';selector.onclick=Genki.quickJisho.lookUp;selector.tabIndex=0;frag.appendChild(box);frag.appendChild(button);frag.appendChild(selector);document.body.appendChild(frag);var footerRight=document.querySelector(".footer-right");footerRight.style.marginRight="40px";Genki.quickJisho.cache={box:box,search:document.getElementById("quick-jisho-search"),results:document.getElementById("quick-jisho-results"),hits:document.getElementById("quick-jisho-hits"),selector:document.getElementById("quick-jisho-selector")};document.onselectionchange=Genki.quickJisho.getSelection;document.onmousemove=function(e){Genki.quickJisho.x=Math.abs(e.pageX-document.body.clientWidth)<100?e.pageX-95:e.pageX;Genki.quickJisho.y=Math.abs(e.pageY-document.body.clientHeight)<40?e.pageY-32:e.pageY+12};document.onkeydown=function(e){if(e.key=="Tab"&&!Genki.quickJisho.selectorHidden&&document.activeElement!=Genki.quickJisho.cache.selector){Genki.quickJisho.tabbing=true;Genki.quickJisho.cache.selector.focus();e.preventDefault()}}},toggle:function(){if(!Genki.jisho&&!Genki.quickJisho.loading){Genki.quickJisho.loading=true;var jisho=document.createElement("SCRIPT");jisho.src=getPaths()+"resources/javascript/jisho.min.js";jisho.onload=function(){if(Genki.quickJisho.cache.search.value){Genki.quickJisho.search(Genki.quickJisho.cache.search.value)}Genki.quickJisho.loading=false};document.body.appendChild(jisho)}if(Genki.quickJisho.hidden){Genki.quickJisho.cache.box.className="";Genki.quickJisho.hidden=false;Genki.quickJisho.cache.search.focus()}else{Genki.quickJisho.cache.box.className="quick-jisho-hidden";Genki.quickJisho.hidden=true}},search:function(value,retry){if(Genki.quickJisho.searchTimeout){window.clearTimeout(Genki.quickJisho.searchTimeout)}Genki.quickJisho.searchTimeout=window.setTimeout(function(){var results="",hits=0,k,i,j,l,ja;Genki.quickJisho.cache.results.innerHTML="";if(value){value=value.toLowerCase();for(k in Genki.jisho){for(i=0,j=Genki.jisho[k].length;i<j;i++){for(l in Genki.jisho[k][i]){if(Genki.jisho[k][i][l].toLowerCase().indexOf(value)!=-1){ja=Genki.jisho[k][i].ja.split("|");results+='<li tabindex="0" class="definition clear">'+'<span class="def-ja'+(ja[1]?" def-furi":"")+'">'+ja[0]+(ja[1]?"<i>"+ja[1]+"</i>":"")+"</span>"+'<span class="def-en">'+Genki.jisho[k][i].en+"</span>"+(Genki.jisho[k][i].v?' <span class="def-vtype">[<i>'+Genki.jisho[k][i].v+"</i>]</span>":"")+'<span class="def-label">'+Genki.jisho[k][i].l+"</span>";"</li>";hits++;break}}}}}if(!retry&&!results&&value&&/[\u3400-\u9faf]/.test(value)){var kanji=value.match(/[\u3400-\u9faf]+/);if(kanji&&kanji[0]){Genki.quickJisho.search(kanji[0],true)}}else{Genki.quickJisho.cache.results.innerHTML=results?results:value?'<li>No results found for "'+value+'".</li>':"";Genki.quickJisho.cache.hits.innerHTML=hits?"("+hits+")":""}delete Genki.quickJisho.searchTimeout},300)},lookUp:function(){if(Genki.quickJisho.hidden){Genki.quickJisho.toggle()}Genki.quickJisho.cache.search.value="".trim?Genki.quickJisho.selectedText.trim():Genki.quickJisho.selectedText;Genki.quickJisho.search(Genki.quickJisho.cache.search.value);this.style.display="none";Genki.quickJisho.selectorHidden=true},getSelection:function(){if(storageOK&&localStorage.genkiJishoLookUp=="false")return false;if(Genki.quickJisho.tabbing){if(!Genki.quickJisho.tabbingOff){Genki.quickJisho.tabbingOff=setTimeout(function(){Genki.quickJisho.tabbing=false;delete Genki.quickJisho.tabbingOff},10)}return false}if(document.getSelection){var selection=document.getSelection();if(selection.type=="Range"&&selection.toString&&!/quick-jisho/.test(selection.focusNode.className)){Genki.quickJisho.selectedText=selection.toString();Genki.quickJisho.cache.selector.style.left=Genki.quickJisho.x+"px";Genki.quickJisho.cache.selector.style.top=Genki.quickJisho.y+"px";if(Genki.quickJisho.selectorHidden){Genki.quickJisho.cache.selector.style.display="";Genki.quickJisho.selectorHidden=false}}else{Genki.quickJisho.selectedText="";if(!Genki.quickJisho.selectorHidden){Genki.quickJisho.cache.selector.style.display="none";Genki.quickJisho.selectorHidden=true}}}}},playAudio:function(id,time){var audio=document.getElementById(id);if(audio){audio.currentTime=time;audio.play()}},viewStrokeOrder:function(kanji,order,kana){var img=getPaths()+"resources/images/stroke-order/"+order+".png";GenkiModal.open({title:kanji+" Stroke Order",content:'<div class="kanji-stroke-order center">'+'<div class="big-kanji'+(kana?" kana-font":"")+'"'+(/り/.test(kanji)?' style="font-family:SawarabiGothic, MS Gothic, Yu Gothic, NotoSansJP, Meiryo;"':"")+">"+kanji+"</div>"+'<a class="button-link" href="'+(kana?getPaths()+"resources/images/stroke-order/sasagami-"+kana+".jpg":"https://jisho.org/search/"+kanji+"%20%23kanji")+'" target="_blank" title="View stroke order '+(kana?"chart":"on jisho.org")+'"><button class="button"><i class="fa">&#xf002;</i></button></a>'+'<a href="'+img+'" target="_blank" title="Click to view image"><img src="'+img+'" alt="stroke order"/></a>'+"</div>"})},getAlts:function(str,alt,arrayOnly){var subs=alt.split("|"),length=subs.length,permutations=Math.pow(2,length),results=[],i=0,bit,bitIndex,subIndex,result;for(;i<permutations;++i){bitIndex=0;result=str.replace(/\{(.*?)\}/g,function(match,p1){subIndex=bitIndex++;bit=length-1-subIndex;return 1<<bit&i?subs[subIndex]:p1});results.push(result)}if(Genki.debug){var len=results.length;console[len/permutations*100==100?"log":"warn"](len+"/"+permutations+" ("+len/permutations*100+"% combo coverage for "+length+" replacements; "+(permutations-len)+" missing combos)",results)}return arrayOnly?results:"%("+results.join("/")+")|"},randomExercise:function(){if(storageOK&&localStorage.genkiRandomExercise=="lesson"&&/lesson-\d+/.test(window.location.href)){var regex=new RegExp(window.location.href.replace(/.*?(lesson-\d+).*/,"$1/")),list=Genki.exercises.filter(function(a){return regex.test(a)})}else if(storageOK&&localStorage.genkiRandomExercise=="completed"&&localStorage.Results&&JSON.parse(localStorage.Results)[localStorage.GenkiEdition]){var editionLessonResults=JSON.parse(localStorage.Results)[localStorage.GenkiEdition];var list=Genki.exercises.filter(function(a){return a.split("|")[0]in editionLessonResults})}else{var list=Genki.exercises}var exercise=list[Math.floor(Math.random()*list.length)].split("|");if(/lesson-\d+/.test(exercise[0])){window.location.href="../../../"+Genki.ed+"/"+exercise[0]+"/"+Genki.local+Genki.debug}else{Genki.randomExercise()}},startOrPauseTimerByVisibility:function(){if(document.hidden&&Genki.timer.isRunning()){Genki.timer.pause()}else if(!document.hidden&&Genki.timer.isPaused()&&!Genki.isTimerPausedByPopup){Genki.timer.start()}},pauseTimerWhenOpenPopup:function(){Genki.timer.pause();Genki.isTimerPausedByPopup=true},startTimerWhenClosePopup:function(){Genki.timer.start();Genki.isTimerPausedByPopup=false},init:function(){var i=0,j=Genki.exercises.length,result=document.getElementById("quiz-result"),lesson;for(;i<j;i++){if(Genki.active.path==Genki.exercises[i].split("|")[0]){Genki.active.exercise=Genki.exercises[i]?Genki.exercises[i].split("|"):null;Genki.active.index=i;break}}if(Genki.active.exercise){lesson=/^appendix/.test(Genki.active.exercise[0])?"appendix":/^study-tools/.test(Genki.active.exercise[0])?"study-tools":+Genki.active.exercise[0].replace(/lesson-(\d+).*/,"$1");result.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center" '+(Genki.active.exercise[2]?'data-page="Genki '+(lesson<13?"I":"II")+(/workbook-|wb-/.test(Genki.active.exercise[0])?" Workbook":"")+": "+Genki.active.exercise[2]+'"':"")+">"+(lesson=="appendix"?"巻末":lesson=="study-tools"?"ツール":"第"+lesson+"課")+" - "+Genki.active.exercise[1]+"</h2>")}else{result.insertAdjacentHTML("beforebegin",'<h2 id="exercise-title" class="center">'+document.querySelector("TITLE").innerText.replace(/\s\|.*/,"")+"</h2>")}if(Genki.isTouch){document.ontouchstart=function(){Genki.isTouching=true};document.ontouchend=function(){Genki.isTouching=false};document.ontouchcancel=function(){Genki.isTouching=false}}Genki.create.exerciseButtons();Genki.create.exerciseList();window.Genki=this}};window.onbeforeunload=function(){var lossDetected=false,type=document.getElementById("exercise").className;if(/quiz-over/.test(type)||document.querySelector(".review-mode")){lossDetected=false}else if(/fill-quiz|writing-quiz/.test(type)){for(var a=document.querySelectorAll(".writing-zone-input"),i=0,j=a.length;i<j;i++){if(a[i].value!=""){lossDetected=true;break}}}else if(/drawing-quiz|stroke-quiz/.test(type)){for(var a=document.querySelectorAll(".kanji-canvas"),i=0,j=a.length;i<j;i++){if(KanjiCanvas["recordedPattern_"+a[i].id].length){lossDetected=true;break}}}else if(/multi-quiz|drag-quiz|kana-quiz/.test(type)&&Genki.stats.solved>0){lossDetected=true}if(lossDetected){return"Your progress will be lost. Do you want to continue?"}};Genki.init()})(window,document);