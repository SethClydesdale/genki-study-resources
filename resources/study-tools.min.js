Genki.tools={type:"",addRow:function(e){for(var t=e.parentNode.cloneNode(!0),o=e.parentNode.parentNode,n=t.querySelectorAll("input, textarea"),i=n.length;i-- >0;)"checkbox"==n[i].type?n[i].checked=!1:n[i].value="";o.appendChild(t),o.scrollTop=9999,this.updateJSON()},removeRow:function(e){e.parentNode.parentNode.removeChild(e.parentNode),this.updateJSON()},updateUI:function(){var e=document.getElementById("study-tool-json");e.value||(e.value="quiz"==this.type?'[{"question":"","answers":[""]}]':"fill"==this.type?'{"quiz":""}':'{"":""}');var t,o,n,i,l,a=JSON.parse(e.value),s='<button class="button row-add" title="add" onclick="Genki.tools.addRow(this);"><i class="fa">&#xf067;</i></button><button class="button row-remove" title="remove" onclick="Genki.tools.removeRow(this);"><i class="fa">&#xf068;</i></button>',u="";if("vocab"==this.type)for(t in a)u+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(t)?t.split("|")[0]:t)+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(t)?t.split("|")[1]:"")+'">&nbsp;<input type="text" placeholder="definition/kana" oninput="Genki.tools.updateJSON();" value="'+a[t]+'">&nbsp;'+s+"</li>";else if("spelling"==this.type)for(t in a)u+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+t+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(a[t]?a[t]:"")+'">&nbsp;'+s+"</li>";else if("quiz"==this.type)for(t=0,o=a.length;t<o;t++){for(l="",n=0,i=a[t].answers.length;n<i;n++)l+='<li class="quiz-answer"><input type="checkbox" title="Correct answer" onchange="Genki.tools.updateJSON();"'+(/^A/.test(a[t].answers[n])?" checked":"")+'><input type="text" placeholder="answer" oninput="Genki.tools.updateJSON();" value="'+(/^A|!/.test(a[t].answers[n])?a[t].answers[n].slice(1):a[t].answers[n])+'">'+s+"</li>";u+='<li class="item-row question-row"><textarea placeholder="question" oninput="Genki.tools.updateJSON();">'+a[t].question+"</textarea>"+s+"<ol>"+l+"</ol></li>"}else"fill"==this.type&&(u='<li class="item-row"><textarea oninput="Genki.tools.updateJSON();">'+a.quiz+"</textarea></li>");document.getElementById("study-tool-ui").innerHTML=u},updateJSON:function(){var e,t,o,n,i,l,a=document.getElementById("study-tool-ui").querySelectorAll(".item-row"),s=0,u=a.length,r={};if("vocab"==this.type)for(;s<u;s++)r[(o=a[s].getElementsByTagName("INPUT"))[0].value+(o[1].value?"|"+o[1].value:"")]=o[2].value;else if("spelling"==this.type)for(;s<u;s++)r[(o=a[s].getElementsByTagName("INPUT"))[0].value]=o[1].value;else if("quiz"==this.type)for(r=[];s<u;s++){for(i=[],e=0,t=(l=a[s].querySelectorAll(".quiz-answer")).length;e<t;e++)o=l[e].getElementsByTagName("INPUT"),i[e]=(o[0].checked?"A":"")+(!o[0].checked&&/^A/.test(o[1].value)?"!":"")+o[1].value;r[s]={question:a[s].getElementsByTagName("TEXTAREA")[0].value,answers:i}}else"fill"==this.type&&(r.quiz=a[s].getElementsByTagName("TEXTAREA")[0].value);n=document.getElementById("prettyCode").checked?JSON.stringify(r,"","  "):JSON.stringify(r),document.getElementById("study-tool-json").value=n,document.getElementById("downloadCode").href="data:,"+encodeURIComponent(n.replace(/\n/g,"\r\n")),window.localStorage[{vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type]]=n},restore:function(){var e={vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type];window.localStorage[e]?(document.getElementById("study-tool-json").value=window.localStorage[e],this.updateUI(),this.updateJSON()):this.updateJSON()},study:function(){document.getElementById("noStudyWarning").checked?this.begin():Genki.modal.open({title:"Ready to Study?",content:'Are you sure you\'re ready to study? Your custom exercise will be temporarily saved to the browser cache, however, if you want to use it again later, click "cancel", and then click "Save code" to save it to a text document. (click "do not warn me" to disable this message)',callback:Genki.tools.begin})},begin:function(){var e=Genki.tools.type,t=document.getElementById("study-tool-json").value.replace(/<script.*?>/g,"<span>").replace(/<\/script>/g,"</span>").replace(/ on.*?=\\".*?\\"/g,"");document.getElementById("study-tool-editor").style.display="none",document.getElementById("exercise").style.display="","vocab"==e?Genki.generateQuiz({type:"drag",info:"Match the definition/kana to the word/kanji.",quizlet:JSON.parse(t)}):"spelling"==e?Genki.generateQuiz({type:"writing",info:"Practice spelling the following words.",columns:+document.getElementById("spellingColumns").value,quizlet:JSON.parse(t)}):"quiz"==e?Genki.generateQuiz({type:"multi",info:"Answer the following questions.",quizlet:JSON.parse(t)}):"fill"==e&&Genki.generateQuiz({type:"fill",info:"Answer the following questions.",quizlet:JSON.parse(t).quiz})},importSnippet:function(e){Genki.modal.open({title:"Import Snippet?",content:"Are you sure you want to import this snippet? It will overwrite your current quiz settings.",callback:function(){document.querySelector("#study-tool-ui textarea").value=document.getElementById(e).value,Genki.tools.updateJSON(),Genki.scrollTo("#quiz-settings")}})},settings:{prettify:function(e){this.handleCheckbox(e),Genki.tools.updateJSON()},handleCheckbox:function(e,t){t?e.checked="true"==t:window.localStorage[e.id]=e.checked},restore:function(){for(var e=["noStudyWarning","prettyCode"],t=0,o=e.length;t<o;t++)window.localStorage[e[t]]&&this.handleCheckbox(document.getElementById(e[t]),window.localStorage[e[t]])}}};